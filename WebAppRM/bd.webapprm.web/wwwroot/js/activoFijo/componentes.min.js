var arrRecepcionActivoFijoDetalleComponentes=Array(),idFilaDatoEspecificoActual=-1,cantComponentesSeleccionados=0;function initComponentes(){$.each($(".btnComponentesDatosEspecificos"),function(e,o){var a=$(o),n=a.data("idfila");addComponenteToArray(n,a.data("idorigen"),$("#hComponentes_"+n).val().split(","))})}function addComponenteToArray(e,o,a){arrRecepcionActivoFijoDetalleComponentes.push({idFilaDatoEspecifico:e,idRecepcionActivoDetalleOrigen:o,arrIdsComponentes:a})}function cargarFormularioComponentesDatosEspecificos(e){mostrarLoadingPanel("checkout-form","Cargando componentes, por favor espere..."),$("#btnAdicionarComponentes").data("idFila",e),idFilaDatoEspecificoActual=e,$.ajax({url:urlModalComponentesResult,method:"POST",data:{componentesActivo:obtenerRecepcionActivoFijoDetalleComponente(),idsComponentesExcluir:obtenerIdsComponentesExcluir(e)},success:function(e){Init_BootBox("Componentes de Activo fijo",'<div id="divContenedorComponentes"><div class="row"><div class="alert alert-info alert-block" style="border-left-width:5px !important;padding-left:20px !important;"><h4 class="alert-heading">Informaci&oacute;n</h4>Un componente de Activo fijo, es un Activo fijo en sí, que se recepcionó con Motivo de alta: "Adici&oacute;n".</br>Haga clic en Adicionar / Eliminar Componentes para visualizar y asignar a este Activo fijo los componentes disponibles que existen en el sistema.</div></div><p><button type="button" class="btn btn-primary" style="padding:7px !important;margin-top:7px !important;margin-left:7px !important;" onclick="cargarListadoActivosFijosParaComponentes()" id="btnAdicionarComponentes">Adicionar / Eliminar Componentes</button></p>'+e+"</div>","large",null,null,function(){isComponentes=!1,cantComponentesSeleccionados=0})},error:function(e){mostrarNotificacion("Error","Ocurrió un error al cargar el formulario.")},complete:function(e){initDataTableFiltrado("tableDetallesActivoFijo",[thClassName.bodega,thClassName.proveedor,thClassName.motivoAlta,thClassName.fechaRecepcion,thClassName.ordenCompra,thClassName.fondoFinanciamiento,thClassName.fechaAlta,thClassName.numeroFactura],function(){var e=$("#tableDetallesActivoFijo").dataTable().api(),o=e.rows({page:"current"}).nodes();crearGrupo(e,o,null,[],2,"Clase de activo fijo",0,24)}),$("#tableDetallesActivoFijo_filter > label > span").prop("style","height:32px !important;"),ajustarBootboxPorCiento(80),isComponentes=!0,cantComponentesSeleccionados=0,$("#checkout-form").waitMe("hide")}})}function cargarListadoActivosFijosParaComponentes(){mostrarLoadingPanel("divContenedorComponentes","Cargando listado de activos fijos, por favor espere...");var e=$("#btnAdicionarComponentes").data("idFila"),o=obtenerRecepcionActivoFijoDetalleComponente(),a=obtenerIdsComponentesExcluir(e);a.push(o.idRecepcionActivoDetalleOrigen),$.ajax({url:urlComponentesActivosFijos,method:"POST",data:{componentesActivo:o,idsComponentesExcluir:a},success:function(e){Init_BootBox("Componentes disponibles",e,"large",null,null,function(){isComponentes=!1,cantComponentesSeleccionados=0})},error:function(e){mostrarNotificacion("Error","Ocurrió un error al cargar el formulario.")},complete:function(e){initDataTableFiltrado("tableDetallesActivoFijoComponentes",[thClassName.bodega,thClassName.proveedor,thClassName.motivoAlta,thClassName.fechaRecepcion,thClassName.ordenCompra,thClassName.fondoFinanciamiento,thClassName.fechaAlta,thClassName.numeroFactura],function(){var e=$("#tableDetallesActivoFijoComponentes").dataTable().api(),o=e.rows({page:"current"}).nodes();crearGrupo(e,o,null,[],3,"Clase de activo fijo",0,24)}),eventoCheckboxDetallesActivoFijo(),$("#tableDetallesActivoFijoComponentes_filter > label > span").prop("style","height:32px !important;"),ajustarBootboxPorCiento(80),$("#divContenedorComponentes").waitMe("hide")}})}function tryMarcarCheckBoxTodosComponentes(){var e=$("#tableDetallesActivoFijoComponentes").dataTable().api().rows().nodes().length;cantComponentesSeleccionados==e?$("#chkDetalleActivoFijo_0").prop("checked","checked"):$("#chkDetalleActivoFijo_0").prop("checked","")}function obtenerIdsComponentesExcluir(e){for(var o=Array(),a=0;a<arrRecepcionActivoFijoDetalleComponentes.length;a++)if(arrRecepcionActivoFijoDetalleComponentes[a].idFilaDatoEspecifico!=e)for(var n=arrRecepcionActivoFijoDetalleComponentes[a].arrIdsComponentes,t=0;t<n.length;t++)o.push(n[t]);return o}function eliminarIdComponente(e,o){for(var a=0;a<o.arrIdsComponentes.length;a++)if(o.arrIdsComponentes[a]==e)return void o.arrIdsComponentes.splice(a,1)}function eliminarComponente(e){for(var o=0;o<arrRecepcionActivoFijoDetalleComponentes.length;o++)if(arrRecepcionActivoFijoDetalleComponentes[o].idFilaDatoEspecifico==e)return void arrRecepcionActivoFijoDetalleComponentes.splice(o,1)}function obtenerRecepcionActivoFijoDetalleComponente(){for(var e=0;e<arrRecepcionActivoFijoDetalleComponentes.length;e++)if(arrRecepcionActivoFijoDetalleComponentes[e].idFilaDatoEspecifico==idFilaDatoEspecificoActual)return arrRecepcionActivoFijoDetalleComponentes[e];return null}function existeIdComponente(e){for(var o=obtenerRecepcionActivoFijoDetalleComponente(),a=0;a<o.arrIdsComponentes.length;a++)if(o.arrIdsComponentes[a]==e)return!0;return!1}function callBackFunctionSeleccionComponente(e,o){if(o){var a="<div id='divEliminarComponente_"+e+"' class='btnEliminarComponentes' style='display:inline;'><a href='javascript: void(0);' id='btnEliminarComponente_"+e+"' onclick=abrirVentanaConfirmacion('btnEliminarComponente_"+e+"') data-funcioncallback=callBackEliminarComponente('"+e+"') data-titulo='Eliminar' data-descripcion='&#191; Desea eliminar el Componente... ?'>Eliminar</a></div>";addRowDetallesActivosFijos("tableDetallesActivoFijo","tableDetallesActivoFijoComponentes",e,[thClassName.codigoSecuencial,thClassName.tipoActivoFijo,thClassName.claseActivoFijo,thClassName.subClaseActivoFijo,thClassName.nombreActivoFijo,thClassName.marca,thClassName.modelo,thClassName.serie,thClassName.numeroChasis,thClassName.numeroMotor,thClassName.placa,thClassName.numeroClaveCatastral,thClassName.sucursal,thClassName.dependencia,thClassName.bodega,thClassName.empleado,thClassName.proveedor,thClassName.motivoAlta,thClassName.fechaRecepcion,thClassName.ordenCompra,thClassName.fondoFinanciamiento,thClassName.fechaAlta,thClassName.numeroFactura,a],!0),obtenerRecepcionActivoFijoDetalleComponente().arrIdsComponentes.push(e)}else callBackEliminarComponente(e);putValuesComponentesenCampoHidden()}function callBackEliminarComponente(e){deleteRowDetallesActivosFijos("tableDetallesActivoFijo",e),eliminarIdComponente(e,obtenerRecepcionActivoFijoDetalleComponente()),putValuesComponentesenCampoHidden()}function putValuesComponentesenCampoHidden(){var e=$("#hComponentes_"+idFilaDatoEspecificoActual),o=obtenerRecepcionActivoFijoDetalleComponente().arrIdsComponentes.join(",");e.val(o)}jQuery(document).ready(function(){initComponentes()});