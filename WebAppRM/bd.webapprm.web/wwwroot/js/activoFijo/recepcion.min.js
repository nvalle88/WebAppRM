var arrIdsfilas=Array(),arrIdsFilasSeleccionados=[];function actualizarSubtotales(a){crearGrupoSubtotal("tableDetallesRecepcion",[{propiedad:thClassName.claseActivoFijo,valor:"Clase de activo fijo"}],thClassName.claseActivoFijo,a)}function gestionarWizard(i){var a=$(".wizard").wizard({disablePreviousStep:!0});a.on("finished.fu.wizard",function(a,o){validarDatosEspecificosPertenecenBodegaEmpleadoCodigosecuencial()?guardarDatosActivoFijoRow():mostrarNotificacion("Error","Tiene que asignar cada dato específico a una Bodega o Empleado y a un Código secuencial.")}),a.on("change.fu.wizard",function(a,o){if("previous"!==o.direction)return i?($(".btn-next").addClass("hide"),!0):validarWizard();i&&$(".btn-next").removeClass("hide")}),a.on("stepclick",function(a,o){if(i)return $(".btn-next").removeClass("hide"),!0})}function generarCodigosecuencial(){return $("#CodigoActivoFijo_SUBCAF").val($("#ActivoFijo_IdSubClaseActivoFijo").val()),$("#CodigoActivoFijo_CAF").val($("#ActivoFijo_SubClaseActivoFijo_IdClaseActivoFijo").val()),$("#CodigoActivoFijo_SUC").val($("#IdSucursal").val()),$("#IdSucursal").val()+"."+(agregarCeros($("#ActivoFijo_SubClaseActivoFijo_IdClaseActivoFijo").val(),3)+".")+(agregarCeros($("#ActivoFijo_IdSubClaseActivoFijo").val(),3)+".")}function actualizarCodigosSecuenciales(){mostrarLoadingPanel("checkout-form","Actualizando códigos secuenciales...");for(var a=0;a<arrIdsfilas.length;a++){var o=arrIdsfilas[a],i=$("#hCodigoSecuencial_"+o).val();if(""!=i&&"-"!=i&&null!=i){var e=generarCodigosecuencial();putDatoCodificacion(o,e+=i.split(".")[3])}}$("#checkout-form").waitMe("hide")}function validarWizard(){return $("#checkout-form").valid()?validarActivoFijoExiste($("#ActivoFijo_IdSubClaseActivoFijo").val(),$("#ActivoFijo_IdModelo").val(),$("#ActivoFijo_Nombre").val()):(mostrarNotificacion("Error","Existen errores en el formulario."),!1)}function validarRecepcion(){var a=$("#tableDetallesRecepcion").dataTable().api(),o=$("#formDatosActivo"),i=!0;0==a.rows().nodes().length&&(mostrarNotificacion("Error","Tiene que adicionar al menos un Activo Fijo."),i=!1),o.valid()||(mostrarNotificacion("Error","Existen errores en el formulario."),i=!1),i&&$("#formDatosActivo").submit()}function eventoTipoActivoFijo(){$("#ActivoFijo_SubClaseActivoFijo_ClaseActivoFijo_IdTipoActivoFijo").on("change",function(a){partialViewTipoActivoFijo(a.val)})}function eventoClaseActivoFijo(){$("#ActivoFijo_SubClaseActivoFijo_IdClaseActivoFijo").on("change",function(a){partialViewClaseActivoFijo(a.val)})}function eventoSubClaseActivoFijo(){$("#ActivoFijo_IdSubClaseActivoFijo").on("change",function(a){actualizarCodigosSecuenciales(),partialViewPolizaSeguro()})}function eventoMarca(){$("#ActivoFijo_Modelo_IdMarca").on("change",function(a){mostrarLoadingPanel("checkout-form","Cargando modelos..."),$.ajax({url:urlModeloSelectResult,method:"POST",data:{idMarca:a.val},success:function(a){$("#div_modelo").html(a),Init_Select2()},complete:function(a){$("#checkout-form").waitMe("hide")}})})}function partialViewTipoActivoFijo(a){mostrarLoadingPanel("checkout-form","Cargando clases de activo fijo..."),$.ajax({url:claseActivoFijoSelectResult,method:"POST",data:{idTipoActivoFijo:obtenerIdAjax(a)},success:function(a){$("#div_claseActivoFijo").html(a),Init_Select2()},error:function(a){$("#checkout-form").waitMe("hide")},complete:function(a){partialViewClaseActivoFijo($("#ActivoFijo_SubClaseActivoFijo_IdClaseActivoFijo").val()),eventoClaseActivoFijo()}})}function partialViewClaseActivoFijo(a){mostrarLoadingPanel("checkout-form","Cargando subclases de activo fijo..."),$.ajax({url:subClaseActivoFijoSelectResult,method:"POST",data:{idClaseActivoFijo:obtenerIdAjax(a)},success:function(a){$("#div_subClaseActivoFijo").html(a),Init_Select2(),partialViewPolizaSeguro()},complete:function(a){$("#checkout-form").waitMe("hide"),obtenerCategoria(function(){eventoCambiarCategoria()}),actualizarCodigosSecuenciales()}})}function partialViewPolizaSeguro(){$.ajax({url:urlPolizaSeguroResult,method:"POST",data:{idSubclaseActivoFijo:$("#ActivoFijo_IdSubClaseActivoFijo").val()},success:function(a){$("#divPolizaSeguro").html(a),Init_Select2()},error:function(a){$("#divPolizaSeguro").html("")},complete:function(a){$("#ActivoFijo_SubClaseActivoFijo_IdSubramo").prop("disabled","disabled")}})}function eventoSpinnerCantidad(){$(".spinnerCantidad").spinner("delay",200).spinner("changed",function(a,o,i){o>arrIdsfilas.length?(crearFilas(o-arrIdsfilas.length),$.each($(".btnEliminarDatosEspecificos"),function(a,o){$(o).removeClass("hide")})):eliminarFilas(arrIdsfilas.length-o)})}function obtenerCategoria(o){mostrarLoadingPanel("tbDatosEspecificos","Cargando datos por categoría..."),$.ajax({url:urlCategoria,method:"POST",data:{idClaseActivoFijo:$("#ActivoFijo_SubClaseActivoFijo_IdClaseActivoFijo").val()},success:function(a){categoria=a.toUpperCase()},error:function(){categoria=""},complete:function(a){o&&o(),$("#tbDatosEspecificos").waitMe("hide")}})}function initArrIdFilas(){for(var a=0;a<maxIdFila;a++)arrIdsfilas.push(a)}function crearFilas(a){for(var o=0;o<a;o++){var i=arrIdsfilas.length,e="<input type='hidden' id='h"+thClassName.numeroClaveCatastral+"_"+i+"'name='h"+thClassName.numeroClaveCatastral+"_"+i+"'/>",t="<input type='hidden' id='h"+thClassName.numeroChasis+"_"+i+"'name='h"+thClassName.numeroChasis+"_"+i+"'/>",c="<input type='hidden' id='h"+thClassName.numeroMotor+"_"+i+"'name='h"+thClassName.numeroMotor+"_"+i+"'/>",l="<input type='hidden' id='h"+thClassName.placa+"_"+i+"'name='h"+thClassName.placa+"_"+i+"'/>",s="<input type='hidden' id='h"+thClassName.serie+"_"+i+"'name='h"+thClassName.serie+"_"+i+"'/>",r="<input type='hidden' id='hBodega_"+i+"'name='hBodega_"+i+"'/>",n="<input type='hidden' id='hEmpleado_"+i+"'name='hEmpleado_"+i+"'/>",d="<input type='hidden' id='hIdRecepcionActivoFijoDetalle_"+i+"' name='hIdRecepcionActivoFijoDetalle_"+i+"' />",h="<input type='hidden' id='hUbicacion_"+i+"' name='hUbicacion_"+i+"' />",v="<input type='hidden' id='hComponentes_"+i+"' name='hComponentes_"+i+"' />",u="<input type='hidden' id='hCodigoSecuencial_"+i+"' name='hCodigoSecuencial_"+i+"' />",p="<input type='hidden' id='hIdCodigoActivoFijo_"+i+"' name='hIdCodigoActivoFijo_"+i+"' />",m="<a href='javascript: void(0);' onclick='cargarFormularioDatosEspecificos("+i+")' class='btnEditarDatosEspecificos' data-idfila='"+i+"'>Editar</a>",C="<span> | </span><a href='javascript: void(0);' onclick='cargarFormularioCodificacion("+i+")' class='btnEditarCodificacion' data-idfila='"+i+"'>Codificaci&oacute;n</a>",f="<span> | </span><a href='javascript: void(0);' onclick='cargarFormularioComponentesDatosEspecificos("+i+")' class='btnComponentesDatosEspecificos' data-idfila='"+i+"' data-idorigen='' data-idscomponentes=''>Componentes</a>",F="<div id='divEliminarDatosEspecificos_"+i+"' class='btnEliminarDatosEspecificos"+(0==arrIdsfilas.length?" hide":"")+"' style='display:inline;'><span> | </span><a href='javascript: void(0);' id='btnEliminarDatosEspecifico_"+i+"' onclick=abrirVentanaConfirmacion('btnEliminarDatosEspecifico_"+i+"') data-funcioncallback='callBackFunctionEliminarDatoEspecifico("+i+")' data-titulo='Eliminar' data-descripcion='&#191; Desea eliminar el Dato Espec&iacute; fico... ?'>Eliminar</a>";mostrarOcultarColumnas("tbDatosEspecificos",[!0,!0,!0,!0,!0]),addRowTableDatosEspecificos(["-","-","-","-","-","-","-","-",e+t+c+l+s+r+n+d+h+v+u+p+m+C+f+F],i,[thClassName.numeroClaveCatastral,thClassName.numeroChasis,thClassName.numeroMotor,thClassName.placa,thClassName.serie,"Bodega","Empleado","Codificacion"]),eventoCambiarCategoria(),arrIdsfilas.push(i),addComponenteToArray(i,0,[])}}function addRowTableDatosEspecificos(a,i,e){var o=$("#tbDatosEspecificos").DataTable().row.add(a).draw().node();$(o).prop("id","trDatosEspecificos_"+i),$.each($(o).children(),function(a,o){a<e.length&&$(o).prop("id","td"+e[a]+"_"+i)})}function deleteRowTableDatosEspecificos(a){var o=$("#trDatosEspecificos_"+a);$("#tbDatosEspecificos").dataTable().fnDeleteRow(o)}function eliminarFilas(a){for(var o=arrIdsfilas.length-1;0<a;){var i=arrIdsfilas[o];deleteRowTableDatosEspecificos(i),arrIdsfilas.splice(o,1),eliminarComponente(i),o--,a--}}function obtenerPosIdFila(a){for(var o=0;o<arrIdsfilas.length;o++)if(arrIdsfilas[o]==a)return o}function eventoCambiarCategoria(){categoria==objCategorias.Edificio?mostrarOcultarColumnas("tbDatosEspecificos",[!0,!1,!1,!1,!0]):categoria==objCategorias.Vehiculo?mostrarOcultarColumnas("tbDatosEspecificos",[!1,!0,!0,!0,!0]):(categoria,objCategorias.EquiposComputoSoftware,mostrarOcultarColumnas("tbDatosEspecificos",[!1,!1,!1,!1,!0]))}function cargarFormularioDatosEspecificos(o){mostrarLoadingPanel("checkout-form","Cargando datos, por favor espere...");var a=new Object;a.RecepcionActivoFijoDetalleEdificio=new Object,a.RecepcionActivoFijoDetalleVehiculo=new Object,categoria==objCategorias.Edificio?a.RecepcionActivoFijoDetalleEdificio.NumeroClaveCatastral=$("#h"+thClassName.numeroClaveCatastral+"_"+o).val():categoria==objCategorias.Vehiculo&&(a.RecepcionActivoFijoDetalleVehiculo.NumeroChasis=$("#h"+thClassName.numeroChasis+"_"+o).val(),a.RecepcionActivoFijoDetalleVehiculo.NumeroMotor=$("#h"+thClassName.numeroMotor+"_"+o).val(),a.RecepcionActivoFijoDetalleVehiculo.Placa=$("#h"+thClassName.placa+"_"+o).val()),a.Serie=$("#h"+thClassName.serie+"_"+o).val(),a.IdBodega=$("#hBodega_"+o).val(),a.IdEmpleado=$("#hEmpleado_"+o).val(),$.ajax({url:urlModalDatosEspecificosResult,method:"POST",data:{rafd:a,categoria:categoria,idSucursal:$("#IdSucursal").val(),idBodega:a.IdBodega,idEmpleado:a.IdEmpleado},success:function(a){Init_BootBox("Editar",a,"large",null,{isGuardar:!0,hideAlGuardar:!1,callbackGuardar:function(){guardarDatosEspecificos()}}),$("#hIdFilaModalDatosEspecificos").val(o),$("#hIdRecepcionActivoFijoDetalle").val($("#hIdRecepcionActivoFijoDetalle_"+o).val()),$("#hIdUbicacionActivoFijo").val($("#hUbicacion_"+o).val()),$("#mFuncionCallbak").val("guardarDatosEspecificos")},error:function(a){mostrarNotificacion("Error","Ocurrió un error al cargar el formulario, inténtelo nuevamente.")},complete:function(a){Init_Select2(),eventoRadioDatosEspecificos(),$("#checkout-form").waitMe("hide")}})}function eventoRadioDatosEspecificos(){$(".radioDatosEspecificos").on("change",function(a){switch($(a.currentTarget).data("ubicacion")){case"Bodega":$("#divDatosEspecificosEmpleado").addClass("hide"),$("#divDatosEspecificosBodega").removeClass("hide");break;default:$("#divDatosEspecificosBodega").addClass("hide"),$("#divDatosEspecificosEmpleado").removeClass("hide")}})}function guardarDatosEspecificos(){mostrarLoadingPanel("divSmartFormModalDatosEspecificos","Validando datos, por favor espere..."),$.each($(".validationDatosEspecificos"),function(a,o){$(o).html("")});var e=new Object;categoria==objCategorias.Edificio?e.NumeroClaveCatastral=$("#RecepcionActivoFijoDetalleEdificio_"+thClassName.numeroClaveCatastral).val():categoria==objCategorias.Vehiculo&&(e.NumeroChasis=$("#RecepcionActivoFijoDetalleVehiculo_"+thClassName.numeroChasis).val(),e.NumeroMotor=$("#RecepcionActivoFijoDetalleVehiculo_"+thClassName.numeroMotor).val(),e.Placa=$("#RecepcionActivoFijoDetalleVehiculo_"+thClassName.placa).val()),e.Serie=$("#"+thClassName.serie).val(),e.IdFila=$("#hIdFilaModalDatosEspecificos").val(),e.IdRecepcionActivoFijoDetalle=$("#hIdRecepcionActivoFijoDetalle").val(),e.IdBodega=$("#IdBodega").val(),e.IdEmpleado=$("#IdEmpleado").val(),e.IsBodega=$("#radioBodegaDatosEspecificos").prop("checked"),validarDatosEspecificosExisten(e)&&validarDatosEspecificosTablaActivosFijosAdicionados(e)?$.ajax({url:urlValidacionDatosEspecificosResult,method:"POST",data:{rafd:e},success:function(a){if(0<a.length)$.each(a,function(a,o){$("#val"+o.propiedad).html(o.valor)});else{var o=$("#hIdFilaModalDatosEspecificos").val();$("#tbDatosEspecificos").DataTable();if(categoria==objCategorias.Edificio?putDatoNumeroClaveCatastralFila(o,e.NumeroClaveCatastral):categoria==objCategorias.Vehiculo&&(putDatoNumeroChasisFila(o,e.NumeroChasis),putDatoNumeroMotorFila(o,e.NumeroMotor),putDatoPlacaFila(o,e.Placa)),putDatoSerieFila(o,e.Serie),e.IsBodega)if($("#chkTodosBodegasDatosEspecificos").prop("checked"))for(var i=0;i<arrIdsfilas.length;i++)putDatoBodegaEmpleadoFila(arrIdsfilas[i],"Bodega",$("#IdBodega option:selected").text(),$("#IdBodega").val()),putDatoBodegaEmpleadoFila(arrIdsfilas[i],"Empleado","-","");else putDatoBodegaEmpleadoFila(o,"Bodega",$("#IdBodega option:selected").text(),$("#IdBodega").val()),putDatoBodegaEmpleadoFila(o,"Empleado","-","");else if($("#chkTodosEmpleadosDatosEspecificos").prop("checked"))for(i=0;i<arrIdsfilas.length;i++)putDatoBodegaEmpleadoFila(arrIdsfilas[i],"Empleado",$("#IdEmpleado option:selected").text(),$("#IdEmpleado").val()),putDatoBodegaEmpleadoFila(arrIdsfilas[i],"Bodega","-","");else putDatoBodegaEmpleadoFila(o,"Empleado",$("#IdEmpleado option:selected").text(),$("#IdEmpleado").val()),putDatoBodegaEmpleadoFila(o,"Bodega","-","");closeBootBox()}},error:function(a){mostrarNotificacion("Error","Ocurrió un error al validar el formulario.")},complete:function(a){$("#divSmartFormModalDatosEspecificos").waitMe("hide")}}):$("#divSmartFormModalDatosEspecificos").waitMe("hide")}function dash(a){return""==(a=a.toString().trim())&&(a="-"),a}function undash(a){return"-"==(a=a.toString().trim())&&(a=""),a}function clearDatosEspecificosBodegaEmpleado(){for(var a=0;a<arrIdsfilas.length;a++)putDatoBodegaEmpleadoFila(arrIdsfilas[a],"Bodega","-",""),putDatoBodegaEmpleadoFila(arrIdsfilas[a],"Empleado","-","")}function putDatoBodegaEmpleadoFila(a,o,i,e){$("#tbDatosEspecificos").DataTable().cell($("#td"+o+"_"+a)).data(i).draw(),$("#h"+o+"_"+a).val(e)}function putDatoNumeroClaveCatastralFila(a,o){$("#tbDatosEspecificos").DataTable().cell($("#td"+thClassName.numeroClaveCatastral+"_"+a)).data(dash(o)).draw(),$("#h"+thClassName.numeroClaveCatastral+"_"+a).val(o)}function putDatoNumeroChasisFila(a,o){$("#tbDatosEspecificos").DataTable().cell($("#td"+thClassName.numeroChasis+"_"+a)).data(dash(o)).draw(),$("#h"+thClassName.numeroChasis+"_"+a).val(o)}function putDatoNumeroMotorFila(a,o){$("#tbDatosEspecificos").DataTable().cell($("#td"+thClassName.numeroMotor+"_"+a)).data(dash(o)).draw(),$("#h"+thClassName.numeroMotor+"_"+a).val(o)}function putDatoPlacaFila(a,o){$("#tbDatosEspecificos").DataTable().cell($("#td"+thClassName.placa+"_"+a)).data(dash(o)).draw(),$("#h"+thClassName.placa+"_"+a).val(o)}function putDatoSerieFila(a,o){$("#tbDatosEspecificos").DataTable().cell($("#td"+thClassName.serie+"_"+a)).data(dash(o)).draw(),$("#h"+thClassName.serie+"_"+a).val(o)}function putDatoCodificacion(a,o){$("#tbDatosEspecificos").DataTable().cell($("#tdCodificacion_"+a)).data(dash(o)).draw(),$("#hCodigoSecuencial_"+a).val(o)}function validarDatosEspecificosPertenecenBodegaEmpleadoCodigosecuencial(){for(var a=0;a<arrIdsfilas.length;a++){var o=arrIdsfilas[a],i=$("#hBodega_"+o).val(),e=$("#hEmpleado_"+o).val(),t=$("#hCodigoSecuencial_"+o).val();if((""==i||null==i)&&(""==e||null==e)||""==t||null==t)return!1}return!0}function validarDatosEspecificosTablaActivosFijosAdicionados(a){var o=parseInt($("#IdFilaGestion").val()),i=!0;if(categoria==objCategorias.Edificio)for(var e=$(".hidden"+thClassName.numeroClaveCatastral).toArray(),t=0;t<e.length;t++){var c=$(e[t]);o!=c.prop("id").split("_")[1]&&null!=a.NumeroClaveCatastral&&""!=a.NumeroClaveCatastral&&c.val()==a.NumeroClaveCatastral&&($("#val"+thClassName.numeroClaveCatastral).html("El Número de clave catastral: está asignado a un Activo Fijo adicionado."),i=!1)}else if(categoria==objCategorias.Vehiculo){var l=$(".hidden"+thClassName.numeroChasis).toArray();for(t=0;t<l.length;t++){var s=$(l[t]);o!=s.prop("id").split("_")[1]&&null!=a.NumeroChasis&&""!=a.NumeroChasis&&s.val()==a.NumeroChasis&&($("#val"+thClassName.numeroChasis).html("El Número de chasis: está asignado a un Activo Fijo adicionado."),i=!1)}var r=$(".hidden"+thClassName.numeroMotor).toArray();for(t=0;t<r.length;t++){var n=$(r[t]);o!=n.prop("id").split("_")[1]&&null!=a.NumeroMotor&&""!=a.NumeroMotor&&n.val()==a.NumeroMotor&&($("#val"+thClassName.numeroMotor).html("El Número de motor: está asignado a un Activo Fijo adicionado."),i=!1)}var d=$(".hidden"+thClassName.placa).toArray();for(t=0;t<d.length;t++){var h=$(d[t]);o!=h.prop("id").split("_")[1]&&null!=a.Placa&&""!=a.Placa&&h.val()==a.Placa&&($("#val"+thClassName.placa).html("La Placa: está asignada a un Activo Fijo adicionado."),i=!1)}}var v=$(".hidden"+thClassName.serie).toArray();for(t=0;t<v.length;t++){var u=$(v[t]);o!=u.prop("id").split("_")[1]&&null!=a.Serie&&""!=a.Serie&&u.val()==a.Serie&&($("#val"+thClassName.serie).html("La Serie: está asignada a un Activo Fijo adicionado."),i=!1)}return i}function validarDatosEspecificosExisten(a){for(var o=!0,i=0;i<arrIdsfilas.length;i++){var e=arrIdsfilas[i];if(a.IdFila!=e){if(categoria==objCategorias.Edificio){if(a.NumeroClaveCatastral==$("#td"+thClassName.numeroClaveCatastral+"_"+e).html())return $("#val"+thClassName.numeroClaveCatastral).html("El Número de clave catastral: ya existe."),!1}else if(categoria==objCategorias.Vehiculo){o=!0;a.NumeroChasis==$("#td"+thClassName.numeroChasis+"_"+e).html()&&($("#val"+thClassName.numeroChasis).html("El Número de chasis: ya existe."),o=!1),a.NumeroMotor==$("#td"+thClassName.numeroMotor+"_"+e).html()&&($("#val"+thClassName.numeroMotor).html("El Número de motor: ya existe."),o=!1),a.Placa==$("#td"+thClassName.placa+"_"+e).html()&&($("#val"+thClassName.placa).html("La Placa: ya existe."),o=!1)}a.Serie==$("#td"+thClassName.serie+"_"+e).html()&&($("#val"+thClassName.serie).html("La Serie: ya existe."),o=!1)}}return o}function validarActivoFijoExiste(a,o,i){for(var e=parseInt($("#IdFilaGestion").val()),t=$(".hiddenNombreActivoFijo").toArray(),c=0;c<t.length;c++){var l=$(t[c]),s=l.prop("id").split("_")[1];if(e!=s){var r=$("#hhIdSubclaseActivoFijo_"+s).val(),n=$("#hhModelo_"+s).val();if(l.val()==i&&r==a&&n==o)return mostrarNotificacion("Error","Ya existe un Activo Fijo con la misma Subclase de activo fijo, Modelo y Nombre."),!1}}return!0}function callBackFunctionEliminarDatoEspecifico(a){var o=obtenerPosIdFila(a);deleteRowTableDatosEspecificos(a),arrIdsfilas.splice(o,1),eliminarComponente(a),$("#ActivoFijo_Cantidad").val(arrIdsfilas.length),1==arrIdsfilas.length&&$("#divEliminarDatosEspecificos_"+arrIdsfilas[0]).addClass("hide")}function cargarFormularioCodificacion(o){mostrarLoadingPanel("checkout-form","Cargando datos, por favor espere...");var a=$("#hCodigoSecuencial_"+o).val(),i=1;if(""!=a&&null!=a)try{var e=a.split(".");i=e[e.length-1]}catch(a){}$.ajax({url:urlCodificacion,method:"POST",data:{Codigosecuencial:$("#hCodigoSecuencial_"+o).val()},success:function(a){Init_BootBox("Codificación",a,"large",null,{isGuardar:!0,hideAlGuardar:!1,callbackGuardar:function(){guardarCodificacion()}}),$("#hIdFilaModalDatosEspecificos").val(o),$("#hIdRecepcionActivoFijoDetalle").val($("#hIdRecepcionActivoFijoDetalle_"+o).val()),$("#mFuncionCallbak").val("guardarCodificacion"),$("#CodigoActivoFijo_Consecutivo").val(i),$(".spinnerNumeroConsecutivo").spinner(),$("#spanCodigoSecuencial").html(generarCodigosecuencial()),asignarNumeroConsecutivoCodigoBarras(),eventoSpinnerNumeroConsecutivo()},error:function(a){mostrarNotificacion("Error","Ocurrió un error al cargar el formulario.")},complete:function(a){$("#checkout-form").waitMe("hide")}})}function guardarCodificacion(){asignarNumeroConsecutivoCodigoBarras(),mostrarLoadingPanel("checkout-form","Validando datos, por favor espere..."),$.each($(".validationCodificacion"),function(a,o){$(o).html("")});var a=$("#hIdFilaModalDatosEspecificos").val(),o={IdFila:a,IdRecepcionActivoFijoDetalle:$("#hIdRecepcionActivoFijoDetalle").val(),Codigosecuencial:$("#spanCodigoSecuencial").html()+$("#spanNumeroConsecutivo").html(),IdCodigoActivoFijo:$("#hIdCodigoActivoFijo_"+a).val()};if($("#chkTodosCodigosDatosEspecificos").prop("checked"))for(var i=0;i<arrIdsfilas.length;i++)putDatoCodificacion(arrIdsfilas[i],o.Codigosecuencial);else putDatoCodificacion(o.IdFila,o.Codigosecuencial);$("#checkout-form").waitMe("hide"),closeBootBox()}function obtenerObjVacioRafd(){return{ActivoFijo:{SubClaseActivoFijo:{ClaseActivoFijo:{}},Modelo:{Marca:{}}},RecepcionActivoFijoDetalleEdificio:{},RecepcionActivoFijoDetalleVehiculo:{},UbicacionActivoFijoActual:{},CodigoActivoFijo:{},ComponentesActivoFijoOrigen:[]}}function cargarModalDatosActivoFijo(o,i){mostrarLoadingPanel("formDatosActivo","Cargando datos de activo fijo..."),arrIdsfilas=[],maxIdFila=0;var a=obtenerObjVacioRafd(),e=[];if(-1!=o){a.ActivoFijo.IdActivoFijo=$("#hhIdActivoFijo_"+o).val(),a.ActivoFijo.SubClaseActivoFijo.ClaseActivoFijo.IdTipoActivoFijo=$("#hhIdTipoActivoFijo_"+o).val(),a.ActivoFijo.SubClaseActivoFijo.IdClaseActivoFijo=$("#hhIdClaseActivoFijo_"+o).val(),a.ActivoFijo.IdSubClaseActivoFijo=$("#hhIdSubclaseActivoFijo_"+o).val(),a.ActivoFijo.Cantidad=$("#hhCantidad_"+o).val(),a.ActivoFijo.Modelo.IdMarca=$("#hhMarca_"+o).val(),a.ActivoFijo.IdModelo=$("#hhModelo_"+o).val(),a.ActivoFijo.Nombre=$("#hhNombreActivoFijo_"+o).val(),a.ActivoFijo.ValorCompra=$("#hhValorCompra_"+o).val(),a.ActivoFijo.Depreciacion=$("#hhDepreciacion_"+o).val(),a.ActivoFijo.ValidacionTecnica=$("#hhValidacionTecnica_"+o).val();try{var t=$("#hh"+thClassName.numeroClaveCatastral+"_"+o).val().split(",")}catch(a){t=[]}try{var c=$("#hh"+thClassName.numeroChasis+"_"+o).val().split(",")}catch(a){c=[]}try{var l=$("#hh"+thClassName.numeroMotor+"_"+o).val().split(",")}catch(a){l=[]}try{var s=$("#hh"+thClassName.placa+"_"+o).val().split(",")}catch(a){s=[]}try{var r=$("#hh"+thClassName.serie+"_"+o).val().split(",")}catch(a){r=[]}try{var n=$("#hhEmpleado_"+o).val().split(",")}catch(a){n=[]}try{var d=$("#hhCodigoSecuencial_"+o).val().split(",")}catch(a){d=[]}try{var h=$("#hhIdCodigoActivoFijo_"+o).val().split(",")}catch(a){h=[]}try{var v=$("#hhUbicacion_"+o).val().split(",")}catch(a){v=[]}try{var u=$("#hhComponentes_"+o).val().split("_")}catch(a){u=[]}try{var p=$("#hhIdRecepcionActivoFijoDetalle_"+o).val().split(",")}catch(a){p=[]}for(var m=$("#hhBodega_"+o).val().split(","),C=0;C<m.length;C++){var f=obtenerObjVacioRafd();try{f.RecepcionActivoFijoDetalleEdificio.NumeroClaveCatastral=undash(t[C])}catch(a){}try{f.RecepcionActivoFijoDetalleVehiculo.NumeroChasis=undash(c[C])}catch(a){}try{f.RecepcionActivoFijoDetalleVehiculo.NumeroMotor=undash(l[C])}catch(a){}try{f.RecepcionActivoFijoDetalleVehiculo.Placa=undash(s[C])}catch(a){}try{f.Serie=undash(r[C])}catch(a){}try{f.CodigoActivoFijo.Codigosecuencial=d[C]}catch(a){}try{f.CodigoActivoFijo.IdCodigoActivoFijo=h[C]}catch(a){}try{f.UbicacionActivoFijoActual.IdUbicacionActivoFijo=v[C]}catch(a){}try{f.IdRecepcionActivoFijoDetalle=p[C]}catch(a){}try{var F=undash(m[C]);null!=F&&""!=F&&(f.UbicacionActivoFijoActual.IdBodega=F)}catch(a){}try{var j=undash(n[C]);null!=j&&""!=j&&(f.UbicacionActivoFijoActual.IdEmpleado=j)}catch(a){}if(0<u.length)try{for(var A=undash(u[C]).split(","),_=0;_<A.length;_++)f.ComponentesActivoFijoOrigen.push({IdRecepcionActivoFijoDetalleComponente:A[_]})}catch(a){}e.push(f)}}$.ajax({url:urlDatosActivoFijoResult,method:"POST",data:{recepcionActivoFijoDetalle:a,listadoRecepcionActivoFijoDetalle:e,isEditar:isEditar,isVistaDetalles:i},success:function(a){Init_BootBox((i?"Detalles de":"Gestionar")+" activo fijo",a,"large",null),$.validator.unobtrusive.parse(document)},error:function(a){mostrarNotificacion("Error","Ocurrió un error al cargar el formulario de activos fijos, inténtelo nuevamente.")},complete:function(a){Init_Select2(),Init_Touchspin(),eventoTipoActivoFijo(),eventoClaseActivoFijo(),eventoSubClaseActivoFijo(),eventoMarca(),gestionarWizard(i),eventoSpinnerCantidad(),initArrIdFilas(),eventoRadioDatosEspecificos(),initComponentes(),initDataTableFiltrado("tbDatosEspecificos",[],null,{mostrarTodos:!0,ocultarTodos:!0},!0),obtenerCategoria(function(){-1==o&&crearFilas(1),eventoCambiarCategoria()}),$("#IdFilaGestion").val(o),i&&($("#ActivoFijo_SubClaseActivoFijo_ClaseActivoFijo_IdTipoActivoFijo").prop("disabled","disabled"),$("#ActivoFijo_SubClaseActivoFijo_IdClaseActivoFijo").prop("disabled","disabled"),$("#ActivoFijo_IdSubClaseActivoFijo").prop("disabled","disabled"),$("#ActivoFijo_Cantidad").prop("disabled","disabled"),$("#ActivoFijo_Modelo_IdMarca").prop("disabled","disabled"),$("#ActivoFijo_IdModelo").prop("disabled","disabled"),$("#ActivoFijo_Nombre").prop("disabled","disabled"),$("#ActivoFijo_ValorCompra").prop("disabled","disabled"),$("#ActivoFijo_Depreciacion").prop("disabled","disabled"),$("#ActivoFijo_ValidacionTecnica").prop("disabled","disabled")),$("#formDatosActivo").waitMe("hide"),partialViewPolizaSeguro()}})}function guardarDatosActivoFijoRow(){var a=parseInt($("#IdFilaGestion").val()),o=-1;-1==a?o=$("#tableDetallesRecepcion").dataTable().api().rows().nodes().length+1:o=a;var i=$("#IdActivoFijo").val(),e=$("#ActivoFijo_SubClaseActivoFijo_ClaseActivoFijo_IdTipoActivoFijo").val(),t=$("#ActivoFijo_SubClaseActivoFijo_IdClaseActivoFijo").val(),c=$("#ActivoFijo_IdSubClaseActivoFijo").val(),l=$("#ActivoFijo_Modelo_IdMarca").val(),s=$("#ActivoFijo_IdModelo").val(),r=$("#ActivoFijo_Cantidad").val(),n=$("#ActivoFijo_Nombre").val(),d=$("#ActivoFijo_ValorCompra").val(),h=$("#ActivoFijo_Depreciacion").prop("checked"),v=$("#ActivoFijo_ValidacionTecnica").prop("checked"),u=$("#ActivoFijo_SubClaseActivoFijo_ClaseActivoFijo_IdTipoActivoFijo option:selected").text(),p=$("#ActivoFijo_SubClaseActivoFijo_IdClaseActivoFijo option:selected").text(),m=$("#ActivoFijo_IdSubClaseActivoFijo option:selected").text(),C=$("#ActivoFijo_Modelo_IdMarca option:selected").text(),f=$("#ActivoFijo_IdModelo option:selected").text(),F=$("#ActivoFijo_SubClaseActivoFijo_Subramo_IdRamo option:selected").text(),j=$("#ActivoFijo_SubClaseActivoFijo_IdSubramo option:selected").text();if(validarActivoFijoExiste(o,c,s,n)){for(var A=[],_=[],g=[],b=[],D=[],I=[],E=[],N=[],S=[],R=[],M=[],y=[],B=0;B<arrIdsfilas.length;B++){var T=arrIdsfilas[B];categoria==objCategorias.Edificio?b.push($("#td"+thClassName.numeroClaveCatastral+"_"+T).html()):categoria==objCategorias.Vehiculo&&(D.push($("#td"+thClassName.numeroChasis+"_"+T).html()),I.push($("#td"+thClassName.numeroMotor+"_"+T).html()),E.push($("#td"+thClassName.placa+"_"+T).html())),N.push($("#td"+thClassName.serie+"_"+T).html()),S.push(dash($("#hBodega_"+T).val())),R.push(dash($("#hEmpleado_"+T).val())),M.push(dash($("#hCodigoSecuencial_"+T).val())),y.push(dash($("#hComponentes_"+T).val())),A.push(dash($("#hIdRecepcionActivoFijoDetalle_"+T).val())),_.push(dash($("#hUbicacion_"+T).val())),g.push(dash($("#hIdCodigoActivoFijo_"+T).val()))}var w=b.join(","),P=D.join(","),V=I.join(","),x=E.join(","),k=N.join(","),z=S.join(","),O=R.join(","),L=M.join(","),U=y.join("_"),G=A.join(","),q=_.join(","),W=g.join(",");if(-1==a){var Y='<input type="hidden" class="hiddenIdRecepcionActivoFijoDetalle" id="hhIdRecepcionActivoFijoDetalle_'+o+'" name="hhIdRecepcionActivoFijoDetalle_'+o+'" value="'+G+'" />',H='<input type="hidden" class="hiddenIdActivoFijo" id="hhIdActivoFijo_'+o+'" name="hhIdActivoFijo_'+o+'" value="'+i+'" />',J="<input type='hidden' class='hiddenNumeroClaveCatastral' id='hhNumeroClaveCatastral_"+o+"'name='hhNumeroClaveCatastral_"+o+"' value='"+w+"' />",K="<input type='hidden' class='hiddenNumeroChasis' id='hhNumeroChasis_"+o+"'name='hhNumeroChasis_"+o+"' value='"+P+"' />",Q="<input type='hidden' class='hiddenNumeroMotor' id='hhNumeroMotor_"+o+"'name='hhNumeroMotor_"+o+"' value='"+V+"' />",X="<input type='hidden' class='hiddenPlaca' id='hhPlaca_"+o+"'name='hhPlaca_"+o+"' value='"+x+"' />",Z="<input type='hidden' class='hiddenSerie' id='hhSerie_"+o+"'name='hhSerie_"+o+"' value='"+k+"' />",aa="<input type='hidden' class='hiddenBodega' id='hhBodega_"+o+"'name='hhBodega_"+o+"' value='"+z+"' />",oa="<input type='hidden' class='hiddenEmpleado' id='hhEmpleado_"+o+"'name='hhEmpleado_"+o+"' value='"+O+"' />",ia="<input type='hidden' class='hiddenUbicacion' id='hhUbicacion_"+o+"' name='hhUbicacion_"+o+"' value='"+q+"' />",ea="<input type='hidden' class='hiddenComponentes' id='hhComponentes_"+o+"' name='hhComponentes_"+o+"' value='"+U+"' />",ta="<input type='hidden' class='hiddenCodigoSecuencial' id='hhCodigoSecuencial_"+o+"' name='hhCodigoSecuencial_"+o+"' value='"+L+"' />",ca="<input type='hidden' class='hiddenCodigoActivoFijo' id='hhIdCodigoActivoFijo_"+o+"' name='hhIdCodigoActivoFijo_"+o+"' value='"+W+"' />",la="<input type='hidden' class='hiddenTipoActivoFijo' id='hhIdTipoActivoFijo_"+o+"' name='hhIdTipoActivoFijo_"+o+"' value='"+e+"' />",sa="<input type='hidden' class='hiddenClaseActivoFijo' id='hhIdClaseActivoFijo_"+o+"' name='hhIdClaseActivoFijo_"+o+"' value='"+t+"' />",ra="<input type='hidden' class='hiddenSubclaseActivoFijo' id='hhIdSubclaseActivoFijo_"+o+"' name='hhIdSubclaseActivoFijo_"+o+"' value='"+c+"' />",na="<input type='hidden' class='hiddenMarca' id='hhMarca_"+o+"' name='hhMarca_"+o+"' value='"+l+"' />",da="<input type='hidden' class='hiddenModelo' id='hhModelo_"+o+"' name='hhModelo_"+o+"' value='"+s+"' />",ha="<input type='hidden' class='hiddenCantidad' id='hhCantidad_"+o+"' name='hhCantidad_"+o+"' value='"+r+"' />",va="<input type='hidden' class='hiddenNombreActivoFijo' id='hhNombreActivoFijo_"+o+"' name='hhNombreActivoFijo_"+o+"' value='"+n+"' />",ua="<input type='hidden' class='hiddenValorCompra' id='hhValorCompra_"+o+"' name='hhValorCompra_"+o+"' value='"+d+"' />",pa="<input type='hidden' class='hiddenDepreciacion' id='hhDepreciacion_"+o+"' name='hhDepreciacion_"+o+"' value='"+h+"' />",ma="<input type='hidden' class='hiddenValidacionTecnica' id='hhValidacionTecnica_"+o+"' name='hhValidacionTecnica_"+o+"' value='"+v+"' />",Ca='<a href="javascript: void(0);" onclick="cargarModalDatosActivoFijo('+o+',true)">Detalles</a><span> | </span>',fa='<a href="javascript: void(0);" onclick="cargarModalDatosActivoFijo('+o+',false)">Editar</a><span> | </span>',Fa="<div id='divEliminarDatosActivoFijo_"+o+"' style='display:inline;'><a href='javascript: void(0);' id='btnEliminarDatosActivoFijo_"+o+"' onclick=abrirVentanaConfirmacion('btnEliminarDatosActivoFijo_"+o+"') data-funcioncallback=callBackFunctionEliminarDatoActivoFijo('"+o+"') data-titulo='Eliminar' data-descripcion='&#191; Desea eliminar el Activo Fijo seleccionado... ?'>Eliminar</a></div>";arrIdsFilasSeleccionados.push(o),addRowDetallesActivosFijosPorArray("tableDetallesRecepcion",o,[thClassName.tipoActivoFijo,thClassName.claseActivoFijo,thClassName.subClaseActivoFijo,thClassName.nombreActivoFijo,thClassName.marca,thClassName.modelo,thClassName.ramo,thClassName.subramo,thClassName.cantidad,thClassName.valorCompra,thClassName.depreciacion,thClassName.validacionTecnica,""],[u,p,m,n,C,f,F,j,r,"$"+d,addRowCheckBox(o,h,null,!0),addRowCheckBox(o,v,null,!0),J+K+Q+X+Z+aa+oa+Y+H+ia+ea+ta+ca+la+sa+ra+na+da+ha+va+ua+pa+ma+Ca+fa+Fa],!0),$("#tableDetallesRecepcion"+o).addClass("trDetallesRecepcion")}else $("#hhNumeroClaveCatastral_"+o).val(w),$("#hhNumeroChasis_"+o).val(P),$("#hhNumeroMotor_"+o).val(V),$("#hhPlaca_"+o).val(x),$("#hhSerie_"+o).val(k),$("#hhBodega_"+o).val(z),$("#hhEmpleado_"+o).val(O),$("#hhIdRecepcionActivoFijoDetalle_"+o).val(G),$("#hhUbicacion_"+o).val(q),$("#hhComponentes_"+o).val(U),$("#hhCodigoSecuencial_"+o).val(L),$("#hhIdCodigoActivoFijo_"+o).val(W),$("#hhIdTipoActivoFijo_"+o).val(e),$("#hhIdClaseActivoFijo_"+o).val(t),$("#hhIdSubclaseActivoFijo_"+o).val(c),$("#hhMarca_"+o).val(l),$("#hhModelo_"+o).val(s),$("#hhCantidad_"+o).val(r),$("#hhNombreActivoFijo_"+o).val(n),$("#hhValorCompra_"+o).val(d),$("#hhDepreciacion_"+o).val(h),$("#hhValidacionTecnica_"+o).val(v),$("#tableDetallesRecepcion"+o+"TipoActivoFijo").html(u),$("#tableDetallesRecepcion"+o+"ClaseActivoFijo").html(p),$("#tableDetallesRecepcion"+o+"SubclaseActivoFijo").html(m),$("#tableDetallesRecepcion"+o+"NombreActivoFijo").html(n),$("#tableDetallesRecepcion"+o+"Marca").html(C),$("#tableDetallesRecepcion"+o+"Modelo").html(f),$("#tableDetallesRecepcion"+o+"Ramo").html(F),$("#tableDetallesRecepcion"+o+"Subramo").html(j),$("#tableDetallesRecepcion"+o+"Cantidad").html(r),$("#tableDetallesRecepcion"+o+"ValorCompra").html(d),$("#tableDetallesRecepcion"+o+"Depreciacion").html(addRowCheckBox(o,h,null,!0)),$("#tableDetallesRecepcion"+o+"ValidacionTecnica").html(addRowCheckBox(o,v,null,!0)),actualizarSubtotales(!0);closeBootBox()}}function callBackFunctionEliminarDatoActivoFijo(a){eliminarElementoArrIdsFilasSeleccionados(a),deleteRowDetallesActivosFijos("tableDetallesRecepcion",a)}function adicionarArrRecepcionActivoFijoDetalle(){var a=idsRecepcionActivoFijoDetalle.split(",");$.each(a,function(a,o){if(""!=o&&null!=o){var i=o.split("_");adicionarRecepcionActivoFijoDetalleSeleccionado(i[0],"true"===i[1].toLowerCase())}})}function callBackFunctionSeleccionActivoFijo(a,o){var i=obtenerRecepcionActivoFijoDetalleSeleccionado(a);i.seleccionado=!!o}function callBackEmitirAprobacion(a){for(var i=[],o=0;o<arrRecepcionActivoFijoDetalleSeleccionado.length;o++)arrRecepcionActivoFijoDetalleSeleccionado[o].seleccionado&&i.push(arrRecepcionActivoFijoDetalleSeleccionado[o].idRecepcionActivoFijoDetalle);0==i.length?mostrarNotificacion("Error","Tiene que seleccionar al menos un Activo Fijo."):(mostrarLoadingPanel("formDatosActivo","Procesando datos, por favor espere..."),$.ajax({url:urlGestionarRevisionActivoFijo,method:"POST",data:{arrIdsActivoFijo:i,aprobacion:a},success:function(a){mostrarNotificacion("Información","La acción se ha realizado satisfactoriamente.");for(var o=0;o<i.length;o++){callBackFunctionEliminarDatoActivoFijo(obtenerPosArrRecepcionActivoFijoDetalleTodos(i[o]))}$("#formDatosActivo").waitMe("hide"),0==$("#tableDetallesRecepcion").dataTable().api().rows().nodes().length&&(mostrarLoadingPanel("formDatosActivo","Redireccionando a listado de Validaciones técnicas..."),window.location.href=urlListadoValidacionesTecnicas)},error:function(a){mostrarNotificacion("Error","Ocurrió un error al procesar los datos, inténtelo nuevamente."),$("#formDatosActivo").waitMe("hide")}}))}function validarPolizaSeguro(){var a=$("#RecepcionActivoFijo_PolizaSeguroActivoFijo_NumeroPoliza").val().trim();""==a||null==a?($("#errorNumeroPoliza").html("Debe introducir el Número de póliza:"),mostrarNotificacion("Error","Existen errores en el formulario.")):$("#formDatosActivo").submit()}function obtenerPosArrIdsFilasSeleccionados(a){for(var o=0;o<arrIdsFilasSeleccionados.length;o++)if(arrIdsFilasSeleccionados[o]==a)return o;return-1}function eliminarElementoArrIdsFilasSeleccionados(a){var o=obtenerPosArrIdsFilasSeleccionados(a);arrIdsFilasSeleccionados.splice(o,1)}$(document).ready(function(){Init_Select2(),Init_DatetimePicker("RecepcionActivoFijo_FechaRecepcion",!0),Init_FileInput("file"),$("#IdSucursal").prop("disabled","disabled"),isRevisionActivoFijo&&adicionarArrRecepcionActivoFijoDetalle(),inicializarArrIdsFilasSeleccionados("tableDetallesRecepcion"),initDataTableFiltrado("tableDetallesRecepcion",[],function(){actualizarSubtotales()},{mostrarTodos:!0}),isRevisionActivoFijo&&inicializarIdsArrRecepcionActivoFijoDetalleTodos()});