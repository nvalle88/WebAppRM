var objName={nameNumeroClaveCatastral:"NumeroClaveCatastral",nameNumeroChasis:"NumeroChasis",nameNumeroMotor:"NumeroMotor",namePlaca:"Placa",nameSerie:"Serie"},objCategorias={Edificio:"EDIFICIOS",MueblesEnseres:"MUEBLES Y ENSERES",EquiposOficina:"EQUIPOS DE OFICINA",Vehiculo:"VEHÍCULOS",EquiposComputoSoftware:"EQUIPOS DE CÓMPUTO Y SOFTWARE"},arrIdsfilas=Array();function ocultarDatosTablaEspecificos(){$(".ColVis").hide(),$("#tbDatosEspecificos").DataTable().page.len(-1).draw(),$(".dataTables_length").hide()}function gestionarWizard(i){var a=$(".wizard").wizard({disablePreviousStep:!0});a.on("finished.fu.wizard",function(a,o){validarDatosEspecificosPertenecenBodegaEmpleadoCodigosecuencial()?guardarDatosActivoFijoRow():mostrarNotificacion("Error","Tiene que asignar cada dato específico a una Bodega o Empleado y a un Código secuencial.")}),a.on("change.fu.wizard",function(a,o){if("previous"!==o.direction)return i?($(".btn-next").addClass("hide"),!0):validarWizard();i&&$(".btn-next").removeClass("hide")}),a.on("stepclick",function(a,o){if(i)return $(".btn-next").removeClass("hide"),!0})}function generarCodigosecuencial(){return $("#CodigoActivoFijo_SUBCAF").val($("#ActivoFijo_IdSubClaseActivoFijo").val()),$("#CodigoActivoFijo_CAF").val($("#ActivoFijo_SubClaseActivoFijo_IdClaseActivoFijo").val()),$("#CodigoActivoFijo_SUC").val($("#IdSucursal").val()),$("#IdSucursal").val()+"."+(agregarCeros($("#ActivoFijo_SubClaseActivoFijo_IdClaseActivoFijo").val(),3)+".")+(agregarCeros($("#ActivoFijo_IdSubClaseActivoFijo").val(),3)+".")}function actualizarCodigosSecuenciales(){for(var o=!0,a=0;a<arrIdsfilas.length;a++){var i=arrIdsfilas[a],e=$("#hCodigoSecuencial_"+i).val();if(""!=e&&"-"!=e&&null!=e){var t=generarCodigosecuencial();validarCodificacionTablaActivosFijos(t+=e.split(".")[3])?(mostrarLoadingPanel("checkout-form","Actualizando códigos secuenciales..."),$.ajax({url:urlValidarCodigoUnico,method:"POST",data:{idCodigoActivoFijo:$("#hIdCodigoActivoFijo_"+i).val(),codigoSecuencial:t},success:function(a){"false"==a.toString().toLowerCase()?putDatoCodificacion(i,t):(putDatoCodificacion(i,""),o=!1)},error:function(a){putDatoCodificacion(i,""),o=!1},complete:function(a){$("#checkout-form").waitMe("hide")}})):(putDatoCodificacion(i,""),o=!1)}}o||mostrarNotificacion("Aviso","Se eliminaron algunos Códigos secuenciales pues se encuentran asignados a un Activo Fijo adicionado ó ya existen en el sistema.")}function validarWizard(){return $("#checkout-form").valid()?validarActivoFijoExiste($("#ActivoFijo_IdSubClaseActivoFijo").val(),$("#ActivoFijo_IdModelo").val(),$("#ActivoFijo_Nombre").val()):(mostrarNotificacion("Error","Existen errores en el formulario."),!1)}function validarRecepcion(){var a=$("#tableDetallesRecepcion").dataTable().api(),o=$("#formDatosActivo"),i=!0;0==a.rows().nodes().length&&(mostrarNotificacion("Error","Tiene que adicionar al menos un Activo Fijo."),i=!1),o.valid()||(mostrarNotificacion("Error","Existen errores en el formulario."),i=!1),i&&$("#formDatosActivo").submit()}function eventoTipoActivoFijo(){$("#ActivoFijo_SubClaseActivoFijo_ClaseActivoFijo_IdTipoActivoFijo").on("change",function(a){partialViewTipoActivoFijo(a.val)})}function eventoClaseActivoFijo(){$("#ActivoFijo_SubClaseActivoFijo_IdClaseActivoFijo").on("change",function(a){partialViewClaseActivoFijo(a.val)})}function eventoSubClaseActivoFijo(){$("#ActivoFijo_IdSubClaseActivoFijo").on("change",function(a){actualizarCodigosSecuenciales()})}function eventoMarca(){$("#ActivoFijo_Modelo_IdMarca").on("change",function(a){mostrarLoadingPanel("checkout-form","Cargando modelos..."),$.ajax({url:urlModeloSelectResult,method:"POST",data:{idMarca:a.val},success:function(a){$("#div_modelo").html(a),Init_Select2()},complete:function(a){$("#checkout-form").waitMe("hide")}})})}function eventoRamo(){$("#RecepcionActivoFijo_PolizaSeguroActivoFijo_Subramo_IdRamo").on("change",function(a){mostrarLoadingPanel("checkout-form","Cargando subramos..."),$.ajax({url:urlSubramoSelectResult,method:"POST",data:{idRamo:a.val},success:function(a){$("#div_subramo").html(a),Init_Select2()},complete:function(a){$("#checkout-form").waitMe("hide")}})})}function partialViewTipoActivoFijo(a){mostrarLoadingPanel("checkout-form","Cargando clases de activo fijo..."),$.ajax({url:claseActivoFijoSelectResult,method:"POST",data:{idTipoActivoFijo:obtenerIdAjax(a)},success:function(a){$("#div_claseActivoFijo").html(a),Init_Select2()},error:function(a){$("#checkout-form").waitMe("hide")},complete:function(a){partialViewClaseActivoFijo($("#ActivoFijo_SubClaseActivoFijo_IdClaseActivoFijo").val()),eventoClaseActivoFijo()}})}function partialViewClaseActivoFijo(a){mostrarLoadingPanel("checkout-form","Cargando subclases de activo fijo..."),$.ajax({url:subClaseActivoFijoSelectResult,method:"POST",data:{idClaseActivoFijo:obtenerIdAjax(a)},success:function(a){$("#div_subClaseActivoFijo").html(a),Init_Select2()},complete:function(a){$("#checkout-form").waitMe("hide"),obtenerCategoria(function(){eventoCambiarCategoria()}),actualizarCodigosSecuenciales()}})}function eventoSpinnerCantidad(){$(".spinnerCantidad").spinner("delay",200).spinner("changed",function(a,o,i){o>arrIdsfilas.length?(crearFilas(o-arrIdsfilas.length),$.each($(".btnEliminarDatosEspecificos"),function(a,o){$(o).removeClass("hide")})):eliminarFilas(arrIdsfilas.length-o)})}function obtenerCategoria(o){mostrarLoadingPanel("tbDatosEspecificos","Cargando datos por categoría..."),$.ajax({url:urlCategoria,method:"POST",data:{idClaseActivoFijo:$("#ActivoFijo_SubClaseActivoFijo_IdClaseActivoFijo").val()},success:function(a){categoria=a.toUpperCase()},error:function(){categoria=""},complete:function(a){o&&o(),$("#tbDatosEspecificos").waitMe("hide")}})}function initArrIdFilas(){for(var a=0;a<maxIdFila;a++)arrIdsfilas.push(a)}function crearFilas(a){for(var o=0;o<a;o++){var i=arrIdsfilas.length,e="<input type='hidden' id='h"+objName.nameNumeroClaveCatastral+"_"+i+"'name='h"+objName.nameNumeroClaveCatastral+"_"+i+"'/>",t="<input type='hidden' id='h"+objName.nameNumeroChasis+"_"+i+"'name='h"+objName.nameNumeroChasis+"_"+i+"'/>",c="<input type='hidden' id='h"+objName.nameNumeroMotor+"_"+i+"'name='h"+objName.nameNumeroMotor+"_"+i+"'/>",l="<input type='hidden' id='h"+objName.namePlaca+"_"+i+"'name='h"+objName.namePlaca+"_"+i+"'/>",r="<input type='hidden' id='h"+objName.nameSerie+"_"+i+"'name='h"+objName.nameSerie+"_"+i+"'/>",n="<input type='hidden' id='hBodega_"+i+"'name='hBodega_"+i+"'/>",d="<input type='hidden' id='hEmpleado_"+i+"'name='hEmpleado_"+i+"'/>",s="<input type='hidden' id='hIdRecepcionActivoFijoDetalle_"+i+"' name='hIdRecepcionActivoFijoDetalle_"+i+"' />",v="<input type='hidden' id='hUbicacion_"+i+"' name='hUbicacion_"+i+"' />",u="<input type='hidden' id='hComponentes_"+i+"' name='hComponentes_"+i+"' />",h="<input type='hidden' id='hCodigoSecuencial_"+i+"' name='hCodigoSecuencial_"+i+"' />",m="<input type='hidden' id='hIdCodigoActivoFijo_"+i+"' name='hIdCodigoActivoFijo_"+i+"' />",p="<a href='javascript: void(0);' onclick='cargarFormularioDatosEspecificos("+i+")' class='btnEditarDatosEspecificos' data-idfila='"+i+"'>Editar</a>",j="<span> | </span><a href='javascript: void(0);' onclick='cargarFormularioCodificacion("+i+")' class='btnEditarCodificacion' data-idfila='"+i+"'>Codificaci&oacute;n</a>",f="<span> | </span><a href='javascript: void(0);' onclick='cargarFormularioComponentesDatosEspecificos("+i+")' class='btnComponentesDatosEspecificos' data-idfila='"+i+"' data-idorigen='' data-idscomponentes=''>Componentes</a>",C="<div id='divEliminarDatosEspecificos_"+i+"' class='btnEliminarDatosEspecificos"+(0==arrIdsfilas.length?" hide":"")+"' style='display:inline;'><span> | </span><a href='javascript: void(0);' id='btnEliminarDatosEspecifico_"+i+"' onclick=abrirVentanaConfirmacion('btnEliminarDatosEspecifico_"+i+"') data-funcioncallback='callBackFunctionEliminarDatoEspecifico("+i+")' data-titulo='Eliminar' data-descripcion='&#191; Desea eliminar el Dato Espec&iacute; fico... ?'>Eliminar</a>";mostrarOcultarColumnas("tbDatosEspecificos",[!0,!0,!0,!0,!0]),addRowTableDatosEspecificos(["-","-","-","-","-","-","-","-",e+t+c+l+r+n+d+s+v+u+h+m+p+j+f+C],i,[objName.nameNumeroClaveCatastral,objName.nameNumeroChasis,objName.nameNumeroMotor,objName.namePlaca,objName.nameSerie,"Bodega","Empleado","Codificacion"]),eventoCambiarCategoria(),arrIdsfilas.push(i),addComponenteToArray(i,0,[])}}function addRowTableDatosEspecificos(a,i,e){var o=$("#tbDatosEspecificos").DataTable().row.add(a).draw().node();$(o).prop("id","trDatosEspecificos_"+i),$.each($(o).children(),function(a,o){a<e.length&&$(o).prop("id","td"+e[a]+"_"+i)})}function deleteRowTableDatosEspecificos(a){var o=$("#trDatosEspecificos_"+a);$("#tbDatosEspecificos").dataTable().fnDeleteRow(o)}function eliminarFilas(a){for(var o=arrIdsfilas.length-1;0<a;){var i=arrIdsfilas[o];deleteRowTableDatosEspecificos(i),arrIdsfilas.splice(o,1),eliminarComponente(i),o--,a--}}function obtenerPosIdFila(a){for(var o=0;o<arrIdsfilas.length;o++)if(arrIdsfilas[o]==a)return o}function eventoCambiarCategoria(){categoria==objCategorias.Edificio?mostrarOcultarColumnas("tbDatosEspecificos",[!0,!1,!1,!1,!0]):categoria==objCategorias.Vehiculo?mostrarOcultarColumnas("tbDatosEspecificos",[!1,!0,!0,!0,!0]):(categoria,objCategorias.EquiposComputoSoftware,mostrarOcultarColumnas("tbDatosEspecificos",[!1,!1,!1,!1,!0]))}function cargarFormularioDatosEspecificos(o){mostrarLoadingPanel("checkout-form","Cargando datos, por favor espere...");var a=new Object;a.RecepcionActivoFijoDetalleEdificio=new Object,a.RecepcionActivoFijoDetalleVehiculo=new Object,categoria==objCategorias.Edificio?a.RecepcionActivoFijoDetalleEdificio.NumeroClaveCatastral=$("#h"+objName.nameNumeroClaveCatastral+"_"+o).val():categoria==objCategorias.Vehiculo&&(a.RecepcionActivoFijoDetalleVehiculo.NumeroChasis=$("#h"+objName.nameNumeroChasis+"_"+o).val(),a.RecepcionActivoFijoDetalleVehiculo.NumeroMotor=$("#h"+objName.nameNumeroMotor+"_"+o).val(),a.RecepcionActivoFijoDetalleVehiculo.Placa=$("#h"+objName.namePlaca+"_"+o).val()),a.Serie=$("#h"+objName.nameSerie+"_"+o).val(),a.IdBodega=$("#hBodega_"+o).val(),a.IdEmpleado=$("#hEmpleado_"+o).val(),$.ajax({url:urlModalDatosEspecificosResult,method:"POST",data:{rafd:a,categoria:categoria,idSucursal:$("#IdSucursal").val(),idBodega:a.IdBodega,idEmpleado:a.IdEmpleado},success:function(a){Init_BootBox("Editar",a,"large",null,{isGuardar:!0,hideAlGuardar:!1,callbackGuardar:function(){guardarDatosEspecificos()}}),$("#hIdFilaModalDatosEspecificos").val(o),$("#hIdRecepcionActivoFijoDetalle").val($("#hIdRecepcionActivoFijoDetalle_"+o).val()),$("#hIdUbicacionActivoFijo").val($("#hUbicacion_"+o).val()),$("#mFuncionCallbak").val("guardarDatosEspecificos")},error:function(a){mostrarNotificacion("Error","Ocurrió un error al cargar el formulario, inténtelo nuevamente.")},complete:function(a){Init_Select2(),eventoRadioDatosEspecificos(),$("#checkout-form").waitMe("hide")}})}function eventoRadioDatosEspecificos(){$(".radioDatosEspecificos").on("change",function(a){switch($(a.currentTarget).data("ubicacion")){case"Bodega":$("#divDatosEspecificosEmpleado").addClass("hide"),$("#divDatosEspecificosBodega").removeClass("hide");break;default:$("#divDatosEspecificosBodega").addClass("hide"),$("#divDatosEspecificosEmpleado").removeClass("hide")}})}function guardarDatosEspecificos(){mostrarLoadingPanel("divSmartFormModalDatosEspecificos","Validando datos, por favor espere..."),$.each($(".validationDatosEspecificos"),function(a,o){$(o).html("")});var e=new Object;categoria==objCategorias.Edificio?e.NumeroClaveCatastral=$("#RecepcionActivoFijoDetalleEdificio_"+objName.nameNumeroClaveCatastral).val():categoria==objCategorias.Vehiculo&&(e.NumeroChasis=$("#RecepcionActivoFijoDetalleVehiculo_"+objName.nameNumeroChasis).val(),e.NumeroMotor=$("#RecepcionActivoFijoDetalleVehiculo_"+objName.nameNumeroMotor).val(),e.Placa=$("#RecepcionActivoFijoDetalleVehiculo_"+objName.namePlaca).val()),e.Serie=$("#"+objName.nameSerie).val(),e.IdFila=$("#hIdFilaModalDatosEspecificos").val(),e.IdRecepcionActivoFijoDetalle=$("#hIdRecepcionActivoFijoDetalle").val(),e.IdBodega=$("#IdBodega").val(),e.IdEmpleado=$("#IdEmpleado").val(),e.IsBodega=$("#radioBodegaDatosEspecificos").prop("checked"),validarDatosEspecificosExisten(e)&&validarDatosEspecificosTablaActivosFijosAdicionados(e)?$.ajax({url:urlValidacionDatosEspecificosResult,method:"POST",data:{rafd:e},success:function(a){if(0<a.length)$.each(a,function(a,o){$("#val"+o.propiedad).html(o.valor)});else{var o=$("#hIdFilaModalDatosEspecificos").val();$("#tbDatosEspecificos").DataTable();if(categoria==objCategorias.Edificio?putDatoNumeroClaveCatastralFila(o,e.NumeroClaveCatastral):categoria==objCategorias.Vehiculo&&(putDatoNumeroChasisFila(o,e.NumeroChasis),putDatoNumeroMotorFila(o,e.NumeroMotor),putDatoPlacaFila(o,e.Placa)),putDatoSerieFila(o,e.Serie),e.IsBodega)if($("#chkTodosBodegasDatosEspecificos").prop("checked"))for(var i=0;i<arrIdsfilas.length;i++)putDatoBodegaEmpleadoFila(arrIdsfilas[i],"Bodega",$("#IdBodega option:selected").text(),$("#IdBodega").val()),putDatoBodegaEmpleadoFila(arrIdsfilas[i],"Empleado","-","");else putDatoBodegaEmpleadoFila(o,"Bodega",$("#IdBodega option:selected").text(),$("#IdBodega").val()),putDatoBodegaEmpleadoFila(o,"Empleado","-","");else if($("#chkTodosEmpleadosDatosEspecificos").prop("checked"))for(i=0;i<arrIdsfilas.length;i++)putDatoBodegaEmpleadoFila(arrIdsfilas[i],"Empleado",$("#IdEmpleado option:selected").text(),$("#IdEmpleado").val()),putDatoBodegaEmpleadoFila(arrIdsfilas[i],"Bodega","-","");else putDatoBodegaEmpleadoFila(o,"Empleado",$("#IdEmpleado option:selected").text(),$("#IdEmpleado").val()),putDatoBodegaEmpleadoFila(o,"Bodega","-","");closeBootBox()}},error:function(a){mostrarNotificacion("Error","Ocurrió un error al validar el formulario.")},complete:function(a){$("#divSmartFormModalDatosEspecificos").waitMe("hide")}}):$("#divSmartFormModalDatosEspecificos").waitMe("hide")}function dash(a){return""==(a=a.toString().trim())&&(a="-"),a}function undash(a){return"-"==(a=a.toString().trim())&&(a=""),a}function clearDatosEspecificosBodegaEmpleado(){for(var a=0;a<arrIdsfilas.length;a++)putDatoBodegaEmpleadoFila(arrIdsfilas[a],"Bodega","-",""),putDatoBodegaEmpleadoFila(arrIdsfilas[a],"Empleado","-","")}function putDatoBodegaEmpleadoFila(a,o,i,e){$("#tbDatosEspecificos").DataTable().cell($("#td"+o+"_"+a)).data(i).draw(),$("#h"+o+"_"+a).val(e)}function putDatoNumeroClaveCatastralFila(a,o){$("#tbDatosEspecificos").DataTable().cell($("#td"+objName.nameNumeroClaveCatastral+"_"+a)).data(dash(o)).draw(),$("#h"+objName.nameNumeroClaveCatastral+"_"+a).val(o)}function putDatoNumeroChasisFila(a,o){$("#tbDatosEspecificos").DataTable().cell($("#td"+objName.nameNumeroChasis+"_"+a)).data(dash(o)).draw(),$("#h"+objName.nameNumeroChasis+"_"+a).val(o)}function putDatoNumeroMotorFila(a,o){$("#tbDatosEspecificos").DataTable().cell($("#td"+objName.nameNumeroMotor+"_"+a)).data(dash(o)).draw(),$("#h"+objName.nameNumeroMotor+"_"+a).val(o)}function putDatoPlacaFila(a,o){$("#tbDatosEspecificos").DataTable().cell($("#td"+objName.namePlaca+"_"+a)).data(dash(o)).draw(),$("#h"+objName.namePlaca+"_"+a).val(o)}function putDatoSerieFila(a,o){$("#tbDatosEspecificos").DataTable().cell($("#td"+objName.nameSerie+"_"+a)).data(dash(o)).draw(),$("#h"+objName.nameSerie+"_"+a).val(o)}function putDatoCodificacion(a,o){$("#tbDatosEspecificos").DataTable().cell($("#tdCodificacion_"+a)).data(dash(o)).draw(),$("#hCodigoSecuencial_"+a).val(o)}function validarDatosEspecificosPertenecenBodegaEmpleadoCodigosecuencial(){for(var a=0;a<arrIdsfilas.length;a++){var o=arrIdsfilas[a],i=$("#hBodega_"+o).val(),e=$("#hEmpleado_"+o).val(),t=$("#hCodigoSecuencial_"+o).val();if((""==i||null==i)&&(""==e||null==e)||""==t||null==t)return!1}return!0}function validarDatosEspecificosTablaActivosFijosAdicionados(a){var o=parseInt($("#IdFilaGestion").val()),i=!0;if(categoria==objCategorias.Edificio)for(var e=$(".hidden"+objName.nameNumeroClaveCatastral).toArray(),t=0;t<e.length;t++){var c=$(e[t]);o!=c.prop("id").split("_")[1]&&null!=a.NumeroClaveCatastral&&""!=a.NumeroClaveCatastral&&c.val()==a.NumeroClaveCatastral&&($("#val"+objName.nameNumeroClaveCatastral).html("El Número de clave catastral: está asignado a un Activo Fijo adicionado."),i=!1)}else if(categoria==objCategorias.Vehiculo){var l=$(".hidden"+objName.nameNumeroChasis).toArray();for(t=0;t<l.length;t++){var r=$(l[t]);o!=r.prop("id").split("_")[1]&&null!=a.NumeroChasis&&""!=a.NumeroChasis&&r.val()==a.NumeroChasis&&($("#val"+objName.nameNumeroChasis).html("El Número de chasis: está asignado a un Activo Fijo adicionado."),i=!1)}var n=$(".hidden"+objName.nameNumeroMotor).toArray();for(t=0;t<n.length;t++){var d=$(n[t]);o!=d.prop("id").split("_")[1]&&null!=a.NumeroMotor&&""!=a.NumeroMotor&&d.val()==a.NumeroMotor&&($("#val"+objName.nameNumeroMotor).html("El Número de motor: está asignado a un Activo Fijo adicionado."),i=!1)}var s=$(".hidden"+objName.namePlaca).toArray();for(t=0;t<s.length;t++){var v=$(s[t]);o!=v.prop("id").split("_")[1]&&null!=a.Placa&&""!=a.Placa&&v.val()==a.Placa&&($("#val"+objName.namePlaca).html("La Placa: está asignada a un Activo Fijo adicionado."),i=!1)}}var u=$(".hidden"+objName.nameSerie).toArray();for(t=0;t<u.length;t++){var h=$(u[t]);o!=h.prop("id").split("_")[1]&&null!=a.Serie&&""!=a.Serie&&h.val()==a.Serie&&($("#val"+objName.nameSerie).html("La Serie: está asignada a un Activo Fijo adicionado."),i=!1)}return i}function validarDatosEspecificosExisten(a){for(var o=!0,i=0;i<arrIdsfilas.length;i++){var e=arrIdsfilas[i];if(a.IdFila!=e){if(categoria==objCategorias.Edificio){if(a.NumeroClaveCatastral==$("#td"+objName.nameNumeroClaveCatastral+"_"+e).html())return $("#val"+objName.nameNumeroClaveCatastral).html("El Número de clave catastral: ya existe."),!1}else if(categoria==objCategorias.Vehiculo){o=!0;a.NumeroChasis==$("#td"+objName.nameNumeroChasis+"_"+e).html()&&($("#val"+objName.nameNumeroChasis).html("El Número de chasis: ya existe."),o=!1),a.NumeroMotor==$("#td"+objName.nameNumeroMotor+"_"+e).html()&&($("#val"+objName.nameNumeroMotor).html("El Número de motor: ya existe."),o=!1),a.Placa==$("#td"+objName.namePlaca+"_"+e).html()&&($("#val"+objName.namePlaca).html("La Placa: ya existe."),o=!1)}a.Serie==$("#td"+objName.nameSerie+"_"+e).html()&&($("#val"+objName.nameSerie).html("La Serie: ya existe."),o=!1)}}return o}function validarActivoFijoExiste(a,o,i){for(var e=parseInt($("#IdFilaGestion").val()),t=$(".hiddenNombreActivoFijo").toArray(),c=0;c<t.length;c++){var l=$(t[c]),r=l.prop("id").split("_")[1];if(e!=r){var n=$("#hhIdSubclaseActivoFijo_"+r).val(),d=$("#hhModelo_"+r).val();if(l.val()==i&&n==a&&d==o)return mostrarNotificacion("Error","Ya existe un Activo Fijo con la misma Subclase de activo fijo, Modelo y Nombre."),!1}}return!0}function callBackFunctionEliminarDatoEspecifico(a){var o=obtenerPosIdFila(a);deleteRowTableDatosEspecificos(a),arrIdsfilas.splice(o,1),eliminarComponente(a),$("#ActivoFijo_Cantidad").val(arrIdsfilas.length),1==arrIdsfilas.length&&$("#divEliminarDatosEspecificos_"+arrIdsfilas[0]).addClass("hide")}function cargarFormularioCodificacion(o){mostrarLoadingPanel("checkout-form","Cargando datos, por favor espere...");var a=$("#hCodigoSecuencial_"+o).val(),i=1;if(""!=a&&null!=a)try{var e=a.split(".");i=e[e.length-1]}catch(a){}$.ajax({url:urlCodificacion,method:"POST",data:{Codigosecuencial:$("#hCodigoSecuencial_"+o).val()},success:function(a){Init_BootBox("Codificación",a,"large",null,{isGuardar:!0,hideAlGuardar:!1,callbackGuardar:function(){guardarCodificacion()}}),$("#hIdFilaModalDatosEspecificos").val(o),$("#hIdRecepcionActivoFijoDetalle").val($("#hIdRecepcionActivoFijoDetalle_"+o).val()),$("#mFuncionCallbak").val("guardarCodificacion"),$("#CodigoActivoFijo_Consecutivo").val(i),$(".spinnerNumeroConsecutivo").spinner(),$("#spanCodigoSecuencial").html(generarCodigosecuencial()),asignarNumeroConsecutivoCodigoBarras(),eventoSpinnerNumeroConsecutivo()},error:function(a){mostrarNotificacion("Error","Ocurrió un error al cargar el formulario.")},complete:function(a){$("#checkout-form").waitMe("hide")}})}function guardarCodificacion(){asignarNumeroConsecutivoCodigoBarras(),mostrarLoadingPanel("checkout-form","Validando datos, por favor espere..."),$.each($(".validationCodificacion"),function(a,o){$(o).html("")});var a=$("#hIdFilaModalDatosEspecificos").val(),o={IdFila:a,IdRecepcionActivoFijoDetalle:$("#hIdRecepcionActivoFijoDetalle").val(),Codigosecuencial:$("#spanCodigoSecuencial").html()+$("#spanNumeroConsecutivo").html(),IdCodigoActivoFijo:$("#hIdCodigoActivoFijo_"+a).val()};validarCodificacionNoExiste(o)?$.ajax({url:urlValidarCodigoUnico,method:"POST",data:{idCodigoActivoFijo:o.IdCodigoActivoFijo,codigoSecuencial:o.Codigosecuencial},success:function(a){"false"==a.toString().toLowerCase()?(putDatoCodificacion(o.IdFila,o.Codigosecuencial),closeBootBox()):$("#valConsecutivo").html("El Código secuencial: ya existe.")},error:function(a){mostrarNotificacion("Error","Ocurrió un error al validar el formulario.")},complete:function(a){$("#checkout-form").waitMe("hide")}}):$("#checkout-form").waitMe("hide")}function validarCodificacionNoExiste(a){for(var o=0;o<arrIdsfilas.length;o++){var i=arrIdsfilas[o];if(a.IdFila!=i&&a.Codigosecuencial==$("#hCodigoSecuencial_"+i).val())return $("#valConsecutivo").html("El Código secuencial: ya existe."),!1}return validarCodificacionTablaActivosFijos(a.Codigosecuencial)}function validarCodificacionTablaActivosFijos(a){for(var o=parseInt($("#IdFilaGestion").val()),i=$(".hiddenCodigoSecuencial").toArray(),e=0;e<i.length;e++){var t=$(i[e]);if(o!=t.prop("id").split("_")[1]&&t.val()==a)return $("#valConsecutivo").html("El Código secuencial: está asignado a un Activo Fijo adicionado."),!1}return!0}function obtenerObjVacioRafd(){return{ActivoFijo:{SubClaseActivoFijo:{ClaseActivoFijo:{}},Modelo:{Marca:{}}},RecepcionActivoFijoDetalleEdificio:{},RecepcionActivoFijoDetalleVehiculo:{},UbicacionActivoFijoActual:{},CodigoActivoFijo:{},ComponentesActivoFijoOrigen:[]}}function cargarModalDatosActivoFijo(o,i){mostrarLoadingPanel("formDatosActivo","Cargando datos de activo fijo..."),arrIdsfilas=[],maxIdFila=0;var a=obtenerObjVacioRafd(),e=[];if(-1!=o){a.ActivoFijo.IdActivoFijo=$("#hhIdActivoFijo_"+o).val(),a.ActivoFijo.SubClaseActivoFijo.ClaseActivoFijo.IdTipoActivoFijo=$("#hhIdTipoActivoFijo_"+o).val(),a.ActivoFijo.SubClaseActivoFijo.IdClaseActivoFijo=$("#hhIdClaseActivoFijo_"+o).val(),a.ActivoFijo.IdSubClaseActivoFijo=$("#hhIdSubclaseActivoFijo_"+o).val(),a.ActivoFijo.Cantidad=$("#hhCantidad_"+o).val(),a.ActivoFijo.Modelo.IdMarca=$("#hhMarca_"+o).val(),a.ActivoFijo.IdModelo=$("#hhModelo_"+o).val(),a.ActivoFijo.Nombre=$("#hhNombreActivoFijo_"+o).val(),a.ActivoFijo.ValorCompra=$("#hhValorCompra_"+o).val(),a.ActivoFijo.Depreciacion=$("#hhDepreciacion_"+o).val(),a.ActivoFijo.ValidacionTecnica=$("#hhValidacionTecnica_"+o).val();try{var t=$("#hh"+objName.nameNumeroClaveCatastral+"_"+o).val().split(",")}catch(a){t=[]}try{var c=$("#hh"+objName.nameNumeroChasis+"_"+o).val().split(",")}catch(a){c=[]}try{var l=$("#hh"+objName.nameNumeroMotor+"_"+o).val().split(",")}catch(a){l=[]}try{var r=$("#hh"+objName.namePlaca+"_"+o).val().split(",")}catch(a){r=[]}try{var n=$("#hh"+objName.nameSerie+"_"+o).val().split(",")}catch(a){n=[]}try{var d=$("#hhEmpleado_"+o).val().split(",")}catch(a){d=[]}try{var s=$("#hhCodigoSecuencial_"+o).val().split(",")}catch(a){s=[]}try{var v=$("#hhIdCodigoActivoFijo_"+o).val().split(",")}catch(a){v=[]}try{var u=$("#hhUbicacion_"+o).val().split(",")}catch(a){u=[]}try{var h=$("#hhComponentes_"+o).val().split("_")}catch(a){h=[]}try{var m=$("#hhIdRecepcionActivoFijoDetalle_"+o).val().split(",")}catch(a){m=[]}for(var p=$("#hhBodega_"+o).val().split(","),j=0;j<p.length;j++){var f=obtenerObjVacioRafd();try{f.RecepcionActivoFijoDetalleEdificio.NumeroClaveCatastral=undash(t[j])}catch(a){}try{f.RecepcionActivoFijoDetalleVehiculo.NumeroChasis=undash(c[j])}catch(a){}try{f.RecepcionActivoFijoDetalleVehiculo.NumeroMotor=undash(l[j])}catch(a){}try{f.RecepcionActivoFijoDetalleVehiculo.Placa=undash(r[j])}catch(a){}try{f.Serie=undash(n[j])}catch(a){}try{f.CodigoActivoFijo.Codigosecuencial=s[j]}catch(a){}try{f.CodigoActivoFijo.IdCodigoActivoFijo=v[j]}catch(a){}try{f.UbicacionActivoFijoActual.IdUbicacionActivoFijo=u[j]}catch(a){}try{f.IdRecepcionActivoFijoDetalle=m[j]}catch(a){}try{var C=undash(p[j]);null!=C&&""!=C&&(f.UbicacionActivoFijoActual.IdBodega=C)}catch(a){}try{var F=undash(d[j]);null!=F&&""!=F&&(f.UbicacionActivoFijoActual.IdEmpleado=F)}catch(a){}if(0<h.length)try{for(var A=undash(h[j]).split(","),b=0;b<A.length;b++)f.ComponentesActivoFijoOrigen.push({IdRecepcionActivoFijoDetalleComponente:A[b]})}catch(a){}e.push(f)}}$.ajax({url:urlDatosActivoFijoResult,method:"POST",data:{recepcionActivoFijoDetalle:a,listadoRecepcionActivoFijoDetalle:e,isEditar:isEditar,isVistaDetalles:i},success:function(a){Init_BootBox((i?"Detalles de":"Gestionar")+" activo fijo",a,"large",null),$.validator.unobtrusive.parse(document)},error:function(a){mostrarNotificacion("Error","Ocurrió un error al cargar el formulario de activos fijos, inténtelo nuevamente.")},complete:function(a){Init_Select2(),Init_Touchspin(),eventoTipoActivoFijo(),eventoClaseActivoFijo(),eventoSubClaseActivoFijo(),eventoMarca(),eventoRamo(),gestionarWizard(i),eventoSpinnerCantidad(),initArrIdFilas(),eventoRadioDatosEspecificos(),initComponentes(),initDataTableFiltrado("tbDatosEspecificos",[]),obtenerCategoria(function(){-1==o&&crearFilas(1),eventoCambiarCategoria()}),ocultarDatosTablaEspecificos(),$("#IdFilaGestion").val(o),i&&($("#ActivoFijo_SubClaseActivoFijo_ClaseActivoFijo_IdTipoActivoFijo").prop("disabled","disabled"),$("#ActivoFijo_SubClaseActivoFijo_IdClaseActivoFijo").prop("disabled","disabled"),$("#ActivoFijo_IdSubClaseActivoFijo").prop("disabled","disabled"),$("#ActivoFijo_Cantidad").prop("disabled","disabled"),$("#ActivoFijo_Modelo_IdMarca").prop("disabled","disabled"),$("#ActivoFijo_IdModelo").prop("disabled","disabled"),$("#ActivoFijo_Nombre").prop("disabled","disabled"),$("#ActivoFijo_ValorCompra").prop("disabled","disabled"),$("#ActivoFijo_Depreciacion").prop("disabled","disabled"),$("#ActivoFijo_ValidacionTecnica").prop("disabled","disabled")),$("#formDatosActivo").waitMe("hide")}})}function guardarDatosActivoFijoRow(){var a=parseInt($("#IdFilaGestion").val()),o=-1;-1==a?o=$("#tableDetallesRecepcion").dataTable().api().rows().nodes().length+1:o=a;var i=$("#IdActivoFijo").val(),e=$("#ActivoFijo_SubClaseActivoFijo_ClaseActivoFijo_IdTipoActivoFijo").val(),t=$("#ActivoFijo_SubClaseActivoFijo_IdClaseActivoFijo").val(),c=$("#ActivoFijo_IdSubClaseActivoFijo").val(),l=$("#ActivoFijo_Modelo_IdMarca").val(),r=$("#ActivoFijo_IdModelo").val(),n=$("#ActivoFijo_Cantidad").val(),d=$("#ActivoFijo_Nombre").val(),s=$("#ActivoFijo_ValorCompra").val(),v=$("#ActivoFijo_Depreciacion").prop("checked"),u=$("#ActivoFijo_ValidacionTecnica").prop("checked"),h=$("#ActivoFijo_SubClaseActivoFijo_ClaseActivoFijo_IdTipoActivoFijo option:selected").text(),m=$("#ActivoFijo_SubClaseActivoFijo_IdClaseActivoFijo option:selected").text(),p=$("#ActivoFijo_IdSubClaseActivoFijo option:selected").text(),j=$("#ActivoFijo_Modelo_IdMarca option:selected").text(),f=$("#ActivoFijo_IdModelo option:selected").text();if(validarActivoFijoExiste(o,c,r,d)){for(var C=[],F=[],A=[],b=[],_=[],g=[],D=[],N=[],E=[],I=[],S=[],R=[],M=0;M<arrIdsfilas.length;M++){var y=arrIdsfilas[M];categoria==objCategorias.Edificio?b.push($("#td"+objName.nameNumeroClaveCatastral+"_"+y).html()):categoria==objCategorias.Vehiculo&&(_.push($("#td"+objName.nameNumeroChasis+"_"+y).html()),g.push($("#td"+objName.nameNumeroMotor+"_"+y).html()),D.push($("#td"+objName.namePlaca+"_"+y).html())),N.push($("#td"+objName.nameSerie+"_"+y).html()),E.push(dash($("#hBodega_"+y).val())),I.push(dash($("#hEmpleado_"+y).val())),S.push(dash($("#hCodigoSecuencial_"+y).val())),R.push(dash($("#hComponentes_"+y).val())),C.push(dash($("#hIdRecepcionActivoFijoDetalle_"+y).val())),F.push(dash($("#hUbicacion_"+y).val())),A.push(dash($("#hIdCodigoActivoFijo_"+y).val()))}var T=b.join(","),P=_.join(","),B=g.join(","),w=D.join(","),V=N.join(","),x=E.join(","),k=I.join(","),O=S.join(","),z=R.join("_"),U=C.join(","),L=F.join(","),G=A.join(",");if(-1==a){var q='<input type="hidden" class="hiddenIdRecepcionActivoFijoDetalle" id="hhIdRecepcionActivoFijoDetalle_'+o+'" name="hhIdRecepcionActivoFijoDetalle_'+o+'" value="'+U+'" />',W='<input type="hidden" class="hiddenIdActivoFijo" id="hhIdActivoFijo_'+o+'" name="hhIdActivoFijo_'+o+'" value="'+i+'" />',Y="<input type='hidden' class='hiddenNumeroClaveCatastral' id='hhNumeroClaveCatastral_"+o+"'name='hhNumeroClaveCatastral_"+o+"' value='"+T+"' />",Q="<input type='hidden' class='hiddenNumeroChasis' id='hhNumeroChasis_"+o+"'name='hhNumeroChasis_"+o+"' value='"+P+"' />",H="<input type='hidden' class='hiddenNumeroMotor' id='hhNumeroMotor_"+o+"'name='hhNumeroMotor_"+o+"' value='"+B+"' />",J="<input type='hidden' class='hiddenPlaca' id='hhPlaca_"+o+"'name='hhPlaca_"+o+"' value='"+w+"' />",K="<input type='hidden' class='hiddenSerie' id='hhSerie_"+o+"'name='hhSerie_"+o+"' value='"+V+"' />",X="<input type='hidden' class='hiddenBodega' id='hhBodega_"+o+"'name='hhBodega_"+o+"' value='"+x+"' />",Z="<input type='hidden' class='hiddenEmpleado' id='hhEmpleado_"+o+"'name='hhEmpleado_"+o+"' value='"+k+"' />",aa="<input type='hidden' class='hiddenUbicacion' id='hhUbicacion_"+o+"' name='hhUbicacion_"+o+"' value='"+L+"' />",oa="<input type='hidden' class='hiddenComponentes' id='hhComponentes_"+o+"' name='hhComponentes_"+o+"' value='"+z+"' />",ia="<input type='hidden' class='hiddenCodigoSecuencial' id='hhCodigoSecuencial_"+o+"' name='hhCodigoSecuencial_"+o+"' value='"+O+"' />",ea="<input type='hidden' class='hiddenCodigoActivoFijo' id='hhIdCodigoActivoFijo_"+o+"' name='hhIdCodigoActivoFijo_"+o+"' value='"+G+"' />",ta="<input type='hidden' class='hiddenTipoActivoFijo' id='hhIdTipoActivoFijo_"+o+"' name='hhIdTipoActivoFijo_"+o+"' value='"+e+"' />",ca="<input type='hidden' class='hiddenClaseActivoFijo' id='hhIdClaseActivoFijo_"+o+"' name='hhIdClaseActivoFijo_"+o+"' value='"+t+"' />",la="<input type='hidden' class='hiddenSubclaseActivoFijo' id='hhIdSubclaseActivoFijo_"+o+"' name='hhIdSubclaseActivoFijo_"+o+"' value='"+c+"' />",ra="<input type='hidden' class='hiddenMarca' id='hhMarca_"+o+"' name='hhMarca_"+o+"' value='"+l+"' />",na="<input type='hidden' class='hiddenModelo' id='hhModelo_"+o+"' name='hhModelo_"+o+"' value='"+r+"' />",da="<input type='hidden' class='hiddenCantidad' id='hhCantidad_"+o+"' name='hhCantidad_"+o+"' value='"+n+"' />",sa="<input type='hidden' class='hiddenNombreActivoFijo' id='hhNombreActivoFijo_"+o+"' name='hhNombreActivoFijo_"+o+"' value='"+d+"' />",va="<input type='hidden' class='hiddenValorCompra' id='hhValorCompra_"+o+"' name='hhValorCompra_"+o+"' value='"+s+"' />",ua="<input type='hidden' class='hiddenDepreciacion' id='hhDepreciacion_"+o+"' name='hhDepreciacion_"+o+"' value='"+v+"' />",ha="<input type='hidden' class='hiddenValidacionTecnica' id='hhValidacionTecnica_"+o+"' name='hhValidacionTecnica_"+o+"' value='"+u+"' />",ma='<a href="javascript: void(0);" onclick="cargarModalDatosActivoFijo('+o+',true)">Detalles</a><span> | </span>',pa='<a href="javascript: void(0);" onclick="cargarModalDatosActivoFijo('+o+',false)">Editar</a><span> | </span>',ja="<div id='divEliminarDatosActivoFijo_"+o+"' style='display:inline;'><a href='javascript: void(0);' id='btnEliminarDatosActivoFijo_"+o+"' onclick=abrirVentanaConfirmacion('btnEliminarDatosActivoFijo_"+o+"') data-funcioncallback=callBackFunctionEliminarDatoActivoFijo('"+o+"') data-titulo='Eliminar' data-descripcion='&#191; Desea eliminar el Activo Fijo seleccionado... ?'>Eliminar</a></div>";addRowDetallesActivosFijosPorArray("tableDetallesRecepcion",o,[thClassName.tipoActivoFijo,thClassName.claseActivoFijo,thClassName.subClaseActivoFijo,thClassName.nombreActivoFijo,thClassName.marca,thClassName.modelo,thClassName.cantidad,thClassName.valorCompra,thClassName.depreciacion,thClassName.validacionTecnica,""],[h,m,p,d,j,f,n,"$"+s,addRowCheckBox(o,v,null,!0),addRowCheckBox(o,u,null,!0),Y+Q+H+J+K+X+Z+q+W+aa+oa+ia+ea+ta+ca+la+ra+na+da+sa+va+ua+ha+ma+pa+ja],!0)}else $("#hhNumeroClaveCatastral_"+o).val(T),$("#hhNumeroChasis_"+o).val(P),$("#hhNumeroMotor_"+o).val(B),$("#hhPlaca_"+o).val(w),$("#hhSerie_"+o).val(V),$("#hhBodega_"+o).val(x),$("#hhEmpleado_"+o).val(k),$("#hhIdRecepcionActivoFijoDetalle_"+o).val(U),$("#hhUbicacion_"+o).val(L),$("#hhComponentes_"+o).val(z),$("#hhCodigoSecuencial_"+o).val(O),$("#hhIdCodigoActivoFijo_"+o).val(G),$("#hhIdTipoActivoFijo_"+o).val(e),$("#hhIdClaseActivoFijo_"+o).val(t),$("#hhIdSubclaseActivoFijo_"+o).val(c),$("#hhMarca_"+o).val(l),$("#hhModelo_"+o).val(r),$("#hhCantidad_"+o).val(n),$("#hhNombreActivoFijo_"+o).val(d),$("#hhValorCompra_"+o).val(s),$("#hhDepreciacion_"+o).val(v),$("#hhValidacionTecnica_"+o).val(u),$("#tableDetallesRecepcion"+o+"TipoActivoFijo").html(h),$("#tableDetallesRecepcion"+o+"ClaseActivoFijo").html(m),$("#tableDetallesRecepcion"+o+"SubclaseActivoFijo").html(p),$("#tableDetallesRecepcion"+o+"NombreActivoFijo").html(d),$("#tableDetallesRecepcion"+o+"Marca").html(j),$("#tableDetallesRecepcion"+o+"Modelo").html(f),$("#tableDetallesRecepcion"+o+"Cantidad").html(n),$("#tableDetallesRecepcion"+o+"ValorCompra").html(s),$("#tableDetallesRecepcion"+o+"Depreciacion").html(addRowCheckBox(o,v,null,!0)),$("#tableDetallesRecepcion"+o+"ValidacionTecnica").html(addRowCheckBox(o,u,null,!0));closeBootBox()}}function callBackFunctionEliminarDatoActivoFijo(a){deleteRowDetallesActivosFijos("tableDetallesRecepcion",a)}function adicionarArrRecepcionActivoFijoDetalle(){var a=idsRecepcionActivoFijoDetalle.split(",");$.each(a,function(a,o){if(""!=o&&null!=o){var i=o.split("_");adicionarRecepcionActivoFijoDetalleSeleccionado(i[0],"true"===i[1].toLowerCase())}})}function callBackFunctionSeleccionActivoFijo(a,o){var i=obtenerRecepcionActivoFijoDetalleSeleccionado(a);i.seleccionado=!!o}function callBackEmitirAprobacion(a){for(var i=[],o=0;o<arrRecepcionActivoFijoDetalleSeleccionado.length;o++)arrRecepcionActivoFijoDetalleSeleccionado[o].seleccionado&&i.push(arrRecepcionActivoFijoDetalleSeleccionado[o].idRecepcionActivoFijoDetalle);0==i.length?mostrarNotificacion("Error","Tiene que seleccionar al menos un Activo Fijo."):(mostrarLoadingPanel("formDatosActivo","Procesando datos, por favor espere..."),$.ajax({url:urlGestionarRevisionActivoFijo,method:"POST",data:{arrIdsActivoFijo:i,aprobacion:a},success:function(a){mostrarNotificacion("Información","La acción se ha realizado satisfactoriamente.");for(var o=0;o<i.length;o++){callBackFunctionEliminarDatoActivoFijo(obtenerPosArrRecepcionActivoFijoDetalleTodos(i[o]))}$("#formDatosActivo").waitMe("hide"),0==$("#tableDetallesRecepcion").dataTable().api().rows().nodes().length&&(mostrarLoadingPanel("formDatosActivo","Redireccionando a listado de Validaciones técnicas..."),window.location.href=urlListadoValidacionesTecnicas)},error:function(a){mostrarNotificacion("Error","Ocurrió un error al procesar los datos, inténtelo nuevamente."),$("#formDatosActivo").waitMe("hide")}}))}function validarPolizaSeguro(){var a=$("#RecepcionActivoFijo_PolizaSeguroActivoFijo_NumeroPoliza").val().trim();""==a||null==a?($("#errorNumeroPoliza").html("Debe introducir el Número de póliza:"),mostrarNotificacion("Error","Existen errores en el formulario.")):$("#formDatosActivo").submit()}$(document).ready(function(){Init_Select2(),Init_DatetimePicker("RecepcionActivoFijo_FechaRecepcion",!0),Init_FileInput("file"),$("#IdSucursal").prop("disabled","disabled"),isRevisionActivoFijo&&adicionarArrRecepcionActivoFijoDetalle(),initDataTableFiltrado("tableDetallesRecepcion",[],function(){var a=$("#tableDetallesRecepcion").dataTable().api(),o=a.rows({page:"current"}).nodes();crearGrupoSubtotal(a,o,null,[],1,"Clase de activo fijo",6,isSeleccion?12:11,7,"tableDetallesRecepcion")}),$("#tableDetallesRecepcion").DataTable().page.len(-1).draw(),isVistaDetalles&&($("#RecepcionActivoFijo_IdMotivoAlta").prop("disabled","disabled"),$("#RecepcionActivoFijo_IdProveedor").prop("disabled","disabled"),$("#RecepcionActivoFijo_IdFondoFinanciamiento").prop("disabled","disabled"),$("#RecepcionActivoFijo_FechaRecepcion").prop("disabled","disabled"),$("#RecepcionActivoFijo_OrdenCompra").prop("disabled","disabled"),$("#RecepcionActivoFijo_PolizaSeguroActivoFijo_Subramo_IdRamo").prop("disabled","disabled"),$("#RecepcionActivoFijo_PolizaSeguroActivoFijo_IdSubramo").prop("disabled","disabled"),$("#RecepcionActivoFijo_PolizaSeguroActivoFijo_IdCompaniaSeguro").prop("disabled","disabled"),isPolizaSeguro||$("#RecepcionActivoFijo_PolizaSeguroActivoFijo_NumeroPoliza").prop("disabled","disabled")),isRevisionActivoFijo&&inicializarIdsArrRecepcionActivoFijoDetalleTodos()});