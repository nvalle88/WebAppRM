var arrAgrupacionColumnas=[],nombreTablaActual="",mostrarBtnAgrupar=!0;function eventoWndAgrupar(o){var r=$(o).data("idtabla");nombreTablaActual=r,mostrarLoadingPanel("content","Cargando ventana de columnas..."),$.ajax({url:urlAgruparFilas,method:"POST",data:{arrColumnas:obtenerArrColumnas(r),idTabla:r},success:function(o){Init_BootBox("Columnas",o,"large")},error:function(o){mostrarNotificacion("Error","Ocurrió un error al cargar la ventana de columnas, inténtelo nuevamente.")},complete:function(o){$("#content").waitMe("hide")}})}function obtenerArrColumnas(o){for(var r=[],n=$("#"+o).dataTable().fnSettings().aoColumns,a=0;a<n.length;a++){var e=$(n[a].nTh).prop("id").replace(o,"").replace("th",""),l=$(n[a].nTh).html(),c=obtenerColumnaSeleccionPorNombre(o,e),u=null!=c&&c.seleccionado;r.push({PropiedadValor:{Propiedad:e,Valor:l},Seleccionado:u})}return r}function obtenerTextoColumna(o,r){for(var n=obtenerArrColumnas(o),a=0;a<n.length;a++)if(n[a].PropiedadValor.Propiedad==r)return n[a].PropiedadValor.Valor;return""}function obtenerColumnaSeleccion(o){for(var r=0;r<arrAgrupacionColumnas.length;r++)if(arrAgrupacionColumnas[r].idTabla==o)return arrAgrupacionColumnas[r];return null}function obtenerColumnaSeleccionPorNombre(o,r){var n=obtenerColumnaSeleccion(o);if(null!=n)for(var a=n.arrColumnasNombreSeleccionado,e=0;e<a.length;e++)if(a[e].nombreColumna==r)return a[e];return null}function obtenerColumnaSeleccionPorNombreSeleccionado(o){var r=[],n=obtenerColumnaSeleccion(o);if(null!=n)for(var a=n.arrColumnasNombreSeleccionado,e=0;e<a.length;e++)a[e].seleccionado&&r.push(a[e].nombreColumna);return r}function obtenerArrFinalColumnaSeleccionPorNombreSeleccionado(o){for(var r=[],n=0;n<o.length;n++)r.push({propiedad:o[n],valor:obtenerTextoColumna(nombreTablaActual,o[n]).replace(":","")});return r}function gestionarArrAgrupacionColumnas(o,r,n){var a=obtenerColumnaSeleccion(o);null==a&&(arrAgrupacionColumnas.push({idTabla:o,arrColumnasNombreSeleccionado:[]}),a=arrAgrupacionColumnas[arrAgrupacionColumnas.length-1]);var e=obtenerColumnaSeleccionPorNombre(o,r);null==e?a.arrColumnasNombreSeleccionado.push({nombreColumna:r,seleccionado:n}):e.seleccionado=n}function callBackFunctionSeleccionColumna(o,r){o=o.replace(nombreTablaActual,""),gestionarArrAgrupacionColumnas(nombreTablaActual,o,r);var n=obtenerArrFinalColumnaSeleccionPorNombreSeleccionado(obtenerColumnaSeleccionPorNombreSeleccionado(nombreTablaActual));changeDrawDataTableFiltrado(nombreTablaActual,function(){crearGrupo(nombreTablaActual,n)})}